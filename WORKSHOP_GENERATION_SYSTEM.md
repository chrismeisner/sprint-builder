# Workshop Generation System

## Overview

Workshops are no longer static deliverables selected from a catalog. Instead, they are **dynamically generated by AI** based on the specific sprint context, deliverables, and client needs. This creates a more personalized, strategic experience for each client.

## Key Changes

### 1. **Workshops Are Not Deliverables**
- ❌ **OLD**: Workshops were stored as deliverables with `deliverable_type = 'workshop'`
- ✅ **NEW**: Workshops are generated by AI and stored directly on the `sprint_drafts` table

### 2. **Studio Review Workflow**
- Sprint Draft created → Status: `draft`
- Studio reviews deliverables and adjusts → Status: `studio_review`
- Studio clicks **"Create Workshop"** → AI generates custom workshop
- Workshop created → Status: `pending_client`
- Client confirms → Status: `in_progress`

### 3. **AI-Powered Workshop Design**
The AI analyzes:
- Sprint deliverables and their complexity
- Client goals from intake form
- Project context and constraints

The AI generates:
- Custom workshop title and objectives
- Detailed agenda with timing
- 1-2 proven workshop exercises (Design Sprint, Lean UX, etc.)
- **Client preparation checklist** (what to bring, who should attend, prep work)
- Expected outcomes and next steps

## Database Schema Changes

### New Columns on `sprint_drafts` Table

```sql
ALTER TABLE sprint_drafts
ADD COLUMN IF NOT EXISTS workshop_agenda jsonb,
ADD COLUMN IF NOT EXISTS workshop_generated_at timestamptz,
ADD COLUMN IF NOT EXISTS workshop_ai_response_id text REFERENCES ai_responses(id) ON DELETE SET NULL;

CREATE INDEX IF NOT EXISTS idx_sprint_drafts_workshop ON sprint_drafts(workshop_generated_at);
```

### Updated Status Constraint

```sql
-- New statuses: 'studio_review' and 'pending_client'
CHECK (status IN ('draft', 'studio_review', 'pending_client', 'in_progress', 'completed', 'cancelled'));
```

### Workshop Deliverables Deactivated

All workshop deliverables (`deliverable_type = 'workshop'`) are marked as `active = false` to prevent them from being selected during sprint creation.

## Workshop JSON Schema

```json
{
  "title": "MVP Product Strategy Workshop",
  "duration": 120,
  "objectives": [
    "Define core MVP features",
    "Validate user flows",
    "Establish technical constraints"
  ],
  "agenda": [
    {
      "section": "Welcome & Context Setting",
      "duration": 10,
      "activities": ["Team introductions", "Review sprint scope"],
      "facilitator": "Studio lead",
      "output": "Aligned understanding of sprint goals"
    }
  ],
  "exercises": [
    {
      "name": "How Might We",
      "source": "Design Sprint by Google Ventures",
      "purpose": "Frame problems as opportunities",
      "timing": "20 minutes",
      "howToRun": ["Step 1...", "Step 2..."]
    }
  ],
  "clientPreparation": {
    "beforeWorkshop": [
      "List 3-5 competitors with links",
      "Compile any existing user research"
    ],
    "toBring": [
      "Product requirements doc",
      "Brand guidelines if available"
    ],
    "attendees": [
      "Decision maker (required)",
      "Product owner or lead",
      "Optional: Subject matter expert"
    ],
    "timeCommitment": "2 hours + 15 min recap"
  },
  "expectedOutcomes": [
    "Prioritized feature list with estimates",
    "Visual direction board with concepts",
    "Shared understanding of target user"
  ],
  "nextSteps": [
    "Studio begins execution on Day 2",
    "First concepts shared by Day 3"
  ],
  "notes": [
    "Ensure decision maker can attend",
    "Miro board will be shared 24h before"
  ]
}
```

## API Endpoints

### Generate Workshop
**POST** `/api/admin/sprint-drafts/[id]/workshop`

- **Auth**: Admin only
- **Requirements**: Sprint status must be `draft` or `studio_review`
- **Action**: Generates workshop using OpenAI, stores in `workshop_agenda`, updates status to `pending_client`

### Remove Workshop
**DELETE** `/api/admin/sprint-drafts/[id]/workshop`

- **Auth**: Admin only
- **Action**: Removes workshop, resets status to `studio_review`

### Clean Up Workshop Deliverables
**POST** `/api/admin/workshops/cleanup`

- **Auth**: Admin only
- **Action**: 
  1. Removes workshops from `sprint_package_deliverables`
  2. Removes workshops from `sprint_deliverables` (active sprints)
  3. Deletes workshops from `deliverables` table
- **Preview**: GET request shows what will be deleted without making changes

**GET** `/api/admin/workshops/cleanup`

- **Auth**: Admin only
- **Action**: Preview what will be deleted (dry run)

## AI Prompts

### System Prompt (`WORKSHOP_GENERATION_SYSTEM_PROMPT`)

You are an expert workshop facilitator designing custom kickoff workshops for 2-week sprints.

Key principles:
- Practical: 90-150 minute workshops
- Strategic: Each exercise serves a clear purpose
- Specific: Exact timing and clear instructions
- Client-ready: Clear preparation checklist
- Proven methods: Draw from Design Sprint, Lean UX, Jobs-to-be-Done, etc.

### User Prompt (`WORKSHOP_GENERATION_USER_PROMPT`)

Provides structure for workshop JSON and context about:
- Sprint deliverables
- Client goals from intake form
- Exercise selection guidance by deliverable type
- Timing and preparation requirements

## UI Components

### WorkshopSection Component
**File**: `app/sprints/[id]/WorkshopSection.tsx`

**Features**:
- "Create Workshop" button for admins (when status is `draft` or `studio_review`)
- "Remove Workshop" button to regenerate if needed
- Displays full workshop agenda with collapsible sections
- Client preparation checklist with checkboxes
- Workshop exercises with detailed instructions
- Expected outcomes and next steps

**States**:
- No workshop + not admin → "Workshop Not Yet Created" placeholder
- No workshop + admin → "Create Workshop" button
- Workshop exists → Full workshop display with collapsible sections

## Updated Sprint Creation Prompts

The default sprint creation prompt **no longer includes workshop selection**:

```
DELIVERABLES GUIDANCE:
- Select 1-3 execution deliverables that BEST match the client's stated needs
- DO NOT include workshop deliverables - those are generated separately by the studio
- Focus on tangible execution deliverables (design, development, content, etc.)
```

## Workflow Example

1. **Client fills intake form** → Document created
2. **AI generates sprint draft** → Selects 2-3 deliverables (NO workshop)
3. **Client reviews draft** → Status: `draft`
4. **Studio admin reviews** → Adjusts deliverables if needed
5. **Studio clicks "Create Workshop"** → AI generates custom workshop
6. **Workshop displayed on sprint page** → Status: `pending_client`
7. **Client sees workshop agenda + prep checklist** → Confirms sprint
8. **Studio starts sprint** → Status: `in_progress`

## Setup Instructions

### 1. Restart Dev Server

The schema changes are applied automatically via `ensureSchema()` on server start:

```bash
# Stop your dev server (Ctrl+C)
# Restart it
npm run dev
```

### 2. Clean Up Workshop Deliverables

After server restart, use the admin cleanup page:

**Option A: Visual Admin Page (Recommended)**
1. Navigate to `http://localhost:3000/dashboard/workshop-cleanup`
2. Click "Preview Cleanup" to see what will be deleted
3. Review the changes (shows which packages/sprints are affected)
4. Click "Confirm & Delete Workshops" to remove them

**Option B: Command Line**
```bash
# Preview what will be deleted
curl http://localhost:3000/api/admin/workshops/cleanup

# Execute cleanup (requires admin session)
curl -X POST http://localhost:3000/api/admin/workshops/cleanup
```

This will:
- Remove workshops from all sprint packages
- Remove workshops from any existing sprint drafts
- Delete workshop deliverables from the deliverables table

### 3. Test Workshop Generation

1. Navigate to an existing sprint draft: `http://localhost:3000/sprints/[sprint-id]`
2. As an admin, click "Create Workshop"
3. Wait 5-10 seconds for AI generation
4. Workshop appears with full agenda and client checklist
5. Sprint status updates to `pending_client`

## Benefits of This Approach

### ✅ **Strategic & Personalized**
Each workshop is custom-tailored to the specific sprint deliverables and client context, not a generic template.

### ✅ **Client Preparation**
Clients get a clear checklist of what to prepare, who should attend, and what to expect. This makes workshops more productive.

### ✅ **Proven Exercises**
AI selects from a library of proven workshop exercises (Design Sprint, Lean UX, etc.) appropriate for the deliverables.

### ✅ **Scalable**
Studio doesn't manually design workshops for each sprint. AI handles it while maintaining quality and consistency.

### ✅ **Flexible**
If workshop isn't quite right, studio can regenerate it with one click.

## Files Modified

### Database
- ✅ `lib/db.ts` - Added workshop columns, updated status constraint

### AI Prompts
- ✅ `lib/prompts.ts` - Added workshop generation prompts, updated sprint creation to exclude workshops

### API Routes
- ✅ `app/api/admin/sprint-drafts/[id]/workshop/route.ts` - **NEW** Generate/delete workshop
- ✅ `app/api/admin/workshops/cleanup/route.ts` - **NEW** Clean up workshop deliverables
- ✅ `app/api/admin/sprint-packages/seed/route.ts` - **UPDATED** Removed workshops from packages

### UI Components
- ✅ `app/sprints/[id]/page.tsx` - Added workshop section display
- ✅ `app/sprints/[id]/WorkshopSection.tsx` - **NEW** Workshop UI component
- ✅ `app/dashboard/workshop-cleanup/page.tsx` - **NEW** Admin cleanup page
- ✅ `app/dashboard/workshop-cleanup/WorkshopCleanupClient.tsx` - **NEW** Cleanup UI

## Future Enhancements

### 1. Workshop Templates
Allow studio to create reusable workshop templates that AI can reference.

### 2. Workshop Scheduling
Add calendar integration to schedule workshop directly from sprint page.

### 3. Workshop Notes
After workshop, studio can add notes and outcomes to the sprint record.

### 4. Client Feedback
After workshop, client can rate the workshop and provide feedback.

### 5. Multi-Workshop Sprints
For longer engagements, generate multiple workshops (kickoff, mid-sprint check-in, handoff).

## Troubleshooting

### Database Column Error
**Error**: `column sd.workshop_agenda does not exist`

**Solution**: Restart dev server to run schema migrations

### Workshop Not Generating
**Error**: OpenAI API timeout or error

**Solutions**:
- Check `OPENAI_API_KEY` is set in `.env`
- Check OpenAI API status
- Try regenerating (click "Remove Workshop" then "Create Workshop" again)

### Status Not Updating
**Error**: Sprint stays in `draft` after creating workshop

**Solution**: Page refresh required after workshop creation (page reloads automatically)

---

**Status**: ✅ Implementation complete - Restart dev server to test

