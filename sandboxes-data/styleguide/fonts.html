<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Typography – Miles Brand Styleguide</title>
  <meta name="description" content="Type scale, font families, weights, and usage guidelines for the Miles design system." />
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://meisner.design/api/sandbox-files/styleguide/fonts.html" />
  <meta property="og:title" content="Typography – Miles Brand Styleguide" />
  <meta property="og:description" content="Type scale, font families, weights, and usage guidelines for the Miles design system." />
  <meta property="og:image" content="https://meisner.design/api/sandbox-files/styleguide/images/scene-03.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />
  <meta property="og:site_name" content="Miles Brand Styleguide" />
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:url" content="https://meisner.design/api/sandbox-files/styleguide/fonts.html" />
  <meta name="twitter:title" content="Typography – Miles Brand Styleguide" />
  <meta name="twitter:description" content="Type scale, font families, weights, and usage guidelines for the Miles design system." />
  <meta name="twitter:image" content="https://meisner.design/api/sandbox-files/styleguide/images/scene-03.jpg" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Inter+Tight:wght@100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="tokens.css" />
  <link rel="stylesheet" href="base.css" />
  <link rel="stylesheet" href="typography-styles.css" />
  <link rel="stylesheet" href="sidebar-nav.css" />
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font-family-sans);
      background: var(--neutral-50);
      color: var(--neutral-900);
      -webkit-font-smoothing: antialiased;
    }

    .wrap {
      max-width: 1400px;
      margin: auto;
      padding: 32px 16px 64px;
    }

    h1 {
      margin: 0 0 8px;
      font-family: var(--font-family-sans);
      font-size: 28px;
      font-weight: 600;
      letter-spacing: -0.02em;
    }

    .subtitle {
      font-family: var(--font-family-sans);
      font-size: 15px;
      font-weight: 400;
      color: var(--neutral-700);
      margin: 0 0 28px;
      line-height: 1.5;
    }

    .card {
      background: var(--neutral-0);
      border: 1px solid var(--neutral-300);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px 20px;
      margin-bottom: 16px;
    }

    .table-wrap {
      overflow: auto;
      border: 1px solid var(--neutral-200);
      border-radius: 12px;
    }

    .table {
      width: 100%;
      border-collapse: collapse;
      min-width: 760px;
      font-size: 13px;
      color: var(--neutral-900);
    }

    .table thead th {
      text-align: left;
      padding: 10px 12px;
      background: var(--neutral-100);
      border-bottom: 1px solid var(--neutral-200);
      font-weight: 700;
      letter-spacing: -0.01em;
    }

    .table tbody td {
      padding: 10px 12px;
      border-bottom: 1px solid var(--neutral-200);
      vertical-align: top;
      color: var(--neutral-700);
    }

    .table tbody tr:last-child td {
      border-bottom: none;
    }

    .table .mono {
      font-family: var(--font-family-mono);
      color: var(--neutral-900);
    }

    .table .subtle {
      color: var(--neutral-700);
    }

    .table .sample {
      color: var(--neutral-900);
      letter-spacing: inherit;
      max-width: 520px;
    }

    .action-btn {
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--neutral-300);
      border-radius: 8px;
      background: var(--neutral-0);
      color: var(--neutral-900);
      cursor: pointer;
      transition: border-color 120ms ease, box-shadow 120ms ease, transform 80ms ease;
      white-space: nowrap;
    }

    .action-btn:hover {
      border-color: var(--brand-primary-500);
      box-shadow: 0 6px 18px rgba(17, 24, 39, 0.08);
    }

    .action-btn:active {
      transform: translateY(1px);
    }

    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 16px;
    }

    .modal-backdrop.show {
      display: flex;
    }

    .modal {
      background: var(--neutral-0);
      border-radius: 12px;
      box-shadow: 0 20px 50px rgba(17, 24, 39, 0.25);
      max-width: 640px;
      width: 100%;
      border: 1px solid var(--neutral-200);
      overflow: hidden;
      animation: pop 160ms ease;
    }

    @keyframes pop {
      from { transform: scale(0.98) translateY(6px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    .modal-header {
      padding: 14px 16px 10px;
      border-bottom: 1px solid var(--neutral-200);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .modal-title {
      margin: 0;
      font-size: 16px;
      letter-spacing: -0.01em;
    }

    .modal-close {
      border: none;
      background: transparent;
      font-size: 18px;
      cursor: pointer;
      color: var(--neutral-700);
      padding: 4px 6px;
      border-radius: 8px;
      line-height: 1;
    }

    .modal-close:hover {
      background: var(--neutral-100);
      color: var(--neutral-900);
    }

    .modal-body {
      padding: 16px;
      display: grid;
      gap: 12px;
    }

    .sample-block {
      padding: 14px 16px;
      border: 1px solid var(--neutral-200);
      border-radius: 10px;
      background: var(--neutral-50);
    }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px 12px;
      font-size: 12px;
      color: var(--neutral-700);
    }

    .meta-grid dt {
      margin: 0;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .meta-grid dd {
      margin: 0;
      color: var(--neutral-700);
      font-family: var(--font-family-mono);
    }

    .section-title {
      margin: 0 0 10px;
      font-size: 16px;
      font-weight: 700;
      color: var(--neutral-900);
      letter-spacing: -0.01em;
    }

    .family-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 12px;
    }

    .family-card {
      border: 1px solid var(--neutral-200);
      border-radius: 12px;
      padding: 14px 16px;
      background: var(--neutral-0);
    }

    .family-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
    }

    .family-name {
      margin: 0;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: -0.01em;
      color: var(--neutral-900);
    }

    .family-var {
      font-family: var(--font-family-mono);
      font-size: 12px;
      color: var(--neutral-700);
      white-space: nowrap;
    }

    .family-sample {
      padding: 10px 12px;
      border: 1px solid var(--neutral-200);
      border-radius: 10px;
      background: var(--neutral-50);
      color: var(--neutral-900);
      margin: 0 0 10px;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin: 0 0 10px;
      padding: 0;
      list-style: none;
    }

    .chip {
      font-family: var(--font-family-mono);
      font-size: 12px;
      padding: 4px 8px;
      border: 1px solid var(--neutral-200);
      border-radius: 999px;
      background: var(--neutral-0);
      color: var(--neutral-900);
    }

    .family-meta {
      display: grid;
      gap: 8px;
      font-size: 13px;
      color: var(--neutral-700);
      line-height: 1.45;
    }

    .family-meta strong {
      color: var(--neutral-900);
    }

    .table-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }

    .table-actions {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .mode-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--neutral-700);
      white-space: nowrap;
    }

    .mode-toggle select {
      border: 1px solid var(--neutral-300);
      border-radius: 8px;
      padding: 6px 10px;
      font-size: 13px;
      background: var(--neutral-0);
      color: var(--neutral-900);
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }

  </style>
</head>
<body>
  <div class="wrap">
    <h1>Typography</h1>
    <p class="subtitle">A compact type scale for marketing and product surfaces.</p>

    <div class="card">
      <div class="table-header">
        <h2 class="section-title" style="margin: 0;">Type scale</h2>
          <div class="table-actions">
            <label class="mode-toggle" for="typeMode">
              <span>View:</span>
              <select id="typeMode" name="typeMode">
                <option value="desktop">Desktop</option>
                <option value="mobile">Mobile</option>
                <option value="google-slides">Google Slides</option>
              </select>
            </label>
            <button type="button" class="action-btn" id="downloadTypeCsv">Download CSV</button>
          </div>
      </div>
      <div class="table-wrap">
        <table class="table" aria-label="Type scale table">
          <thead>
            <tr>
              <th>Style</th>
              <th>Sample</th>
              <th>Family</th>
              <th>Size</th>
              <th>Weight</th>
              <th>Line Height</th>
              <th>Tracking</th>
              <th>Usage</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="typeTableBody"></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <h2 class="section-title">Font families</h2>
      <div id="fontFamilies" class="family-grid" aria-live="polite"></div>
    </div>

  </div>

  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modalTitle">Preview</h2>
        <button class="modal-close" type="button" aria-label="Close modal" id="modalClose">×</button>
      </div>
      <div class="modal-body">
        <div id="modalSample" class="sample-block"></div>
        <dl class="meta-grid" id="modalMeta"></dl>
      </div>
    </div>

  </div>

  <div id="editModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="editModalTitle">Edit style</h2>
        <button class="modal-close" type="button" aria-label="Close edit modal" id="editModalClose">×</button>
      </div>
      <div class="modal-body">
        <form id="editForm" class="sample-block" style="display:grid; gap:10px;">
          <div class="meta-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap:10px 12px;">
            <div>
              <label class="section-title" style="font-size:13px; margin:0 0 4px;">Family</label>
              <select id="editFamily" name="family" style="width:100%; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px; background:var(--neutral-0); color:var(--neutral-900);">
                <option value="var(--font-family-acme)">Acme Gothic Condensed</option>
                <option value="var(--font-family-tight)">Inter Tight</option>
                <option value="var(--font-family-sans)">Inter</option>
                <option value="var(--font-family-mono)">Mono</option>
              </select>
            </div>
            <div>
              <label class="section-title" style="font-size:13px; margin:0 0 4px;">Weight</label>
              <input id="editWeight" name="weight" type="number" step="1" min="100" max="900" style="width:100%; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
            </div>
            <div>
              <label class="section-title" style="font-size:13px; margin:0 0 4px;">Tracking</label>
              <input id="editTracking" name="tracking" type="text" placeholder="-0.01em" style="width:100%; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
            </div>
            <div style="display:flex; align-items:center; gap:8px; margin-top:18px;">
              <input id="editAllCaps" name="allCaps" type="checkbox" />
              <label for="editAllCaps" style="font-size:13px; color:var(--neutral-900);">All caps</label>
            </div>
          </div>

          <div class="meta-grid" style="grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:10px 12px;">
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:10px 12px;">
              <div>
                <label class="section-title" style="font-size:13px; margin:0 0 4px;">Size (Desktop)</label>
                <div style="display:flex; gap:4px;">
                  <input id="editSizeDesktopValue" name="sizeDesktopValue" type="number" step="1" placeholder="48" style="flex:1; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
                  <select id="editSizeDesktopUnit" name="sizeDesktopUnit" style="border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px; background:var(--neutral-0); color:var(--neutral-900);">
                    <option value="px">px</option>
                    <option value="rem">rem</option>
                    <option value="em">em</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="section-title" style="font-size:13px; margin:0 0 4px;">Line-height (Desktop)</label>
                <input id="editLineHeightDesktop" name="lineHeightDesktop" type="number" step="0.01" placeholder="1.2" style="width:100%; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
              </div>
            </div>
            <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:10px 12px;">
              <div>
                <label class="section-title" style="font-size:13px; margin:0 0 4px;">Size (Mobile)</label>
                <div style="display:flex; gap:4px;">
                  <input id="editSizeMobileValue" name="sizeMobileValue" type="number" step="1" placeholder="36" style="flex:1; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
                  <select id="editSizeMobileUnit" name="sizeMobileUnit" style="border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px; background:var(--neutral-0); color:var(--neutral-900);">
                    <option value="px">px</option>
                    <option value="rem">rem</option>
                    <option value="em">em</option>
                  </select>
                </div>
              </div>
              <div>
                <label class="section-title" style="font-size:13px; margin:0 0 4px;">Line-height (Mobile)</label>
                <input id="editLineHeightMobile" name="lineHeightMobile" type="number" step="0.01" placeholder="1.2" style="width:100%; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
              </div>
            </div>
          </div>

          <div class="meta-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:10px 12px;">
            <div>
              <label class="section-title" style="font-size:13px; margin:0 0 4px;">Sample text</label>
              <input id="editSample" name="sample" type="text" style="width:100%; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
            </div>
            <div>
              <label class="section-title" style="font-size:13px; margin:0 0 4px;">Usage</label>
              <input id="editUsage" name="usage" type="text" style="width:100%; border:1px solid var(--neutral-300); border-radius:8px; padding:6px 10px; font-size:13px;" />
            </div>
          </div>

          <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:4px;">
            <button type="button" class="action-btn" id="editCancel">Close</button>
            <button type="submit" class="action-btn" style="border-color: var(--brand-primary-500); color: var(--brand-primary-500);">Apply</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script type="module">
    // Import typography data from single source of truth
    import { fontFamilies, typeCatalog, familyLabels, familyValueByVar, googleSlidesAlternatives } from './typography-data.js';

    // Make data available to non-module scripts
    window.__TYPOGRAPHY_DATA__ = { fontFamilies, typeCatalog, familyLabels, familyValueByVar, googleSlidesAlternatives };
  </script>

  <script>
    // Use typography data from window (set by module script above)
    const { fontFamilies, typeCatalog, familyLabels, familyValueByVar, googleSlidesAlternatives } = window.__TYPOGRAPHY_DATA__ || {};

    // Fallback font families data (if module import fails)
    const fontFamiliesFallback = [
      {
        name: "Acme Gothic Condensed",
        css: "var(--font-family-acme)",
        variable: "--font-family-acme",
        weights: [600],
        sample: "CONDENSED PUNCH FOR HERO HEADLINES",
        sampleTransform: "uppercase",
        blurb: "Tall, condensed display face with strong presence. Always use in ALL CAPS.",
        references: "Local font: Acme Gothic Condensed Semi Bold.",
        bestFor: "Hero H1 headlines and bold marketing statements.",
        resourceUrl: "fonts/Acme-Gothic-Condensed-Semi-Bold.otf",
        secondaryResourceUrl: "https://fonts.adobe.com/fonts/acme-gothic",
        isDownload: true
      },
      {
        name: "Special Gothic Condensed One",
        css: "var(--font-family-special)",
        variable: "--font-family-special",
        weights: [400],
        sample: "BOLD CONDENSED DISPLAY FOR SLIDES",
        sampleTransform: "uppercase",
        blurb: "Strong condensed display face for Google Slides. Great Acme Gothic alternative.",
        references: "Local font: Special Gothic Condensed One Regular.",
        bestFor: "Headlines in Google Slides presentations where Acme Gothic isn't available.",
        resourceUrl: "fonts/SpecialGothicCondensedOne-Regular.ttf",
        secondaryResourceUrl: "https://fonts.google.com/specimen/Special+Gothic+Condensed+One",
        isDownload: true
      },
      {
        name: "Inter",
        css: "var(--font-family-sans)",
        variable: "--font-family-sans",
        weights: [300, 400, 500, 600, 700, 800],
        sample: "The quick brown fox jumps over the lazy dog.",
        blurb: "Neutral, highly readable sans-serif with a modern UI feel.",
        references: "Google Fonts: Inter.",
        bestFor: "Body text, UI copy, buttons, labels, and general-purpose headings.",
        resourceUrl: "https://rsms.me/inter/download/"
      },
      {
        name: "Inter Tight",
        css: "var(--font-family-tight)",
        variable: "--font-family-tight",
        weights: [300, 400, 500, 600, 700, 800],
        sample: "Inter Tight — slightly more compact for headlines.",
        blurb: "A tighter-width companion to Inter for punchier display copy.",
        references: "Google Fonts: Inter Tight.",
        bestFor: "Hero headlines, section titles, and compact headings.",
        resourceUrl: "https://fonts.google.com/specimen/Inter+Tight"
      }
    ];

    const typeCatalogFallback = [
      {
        title: "Headings",
        items: [
          { name: "H1", sizeDesktop: "60px", sizeMobile: "52px", lineHeight: 1, lineHeightMobile: 1, weight: 600, letterSpacing: "0em", sample: "HEADING 1 — PAGE TITLE", usage: "Page / document title", fontFamily: "var(--font-family-acme)", transform: "uppercase" },
          { name: "H2", sizeDesktop: "48px", sizeMobile: "40px", lineHeight: 1, lineHeightMobile: 1, weight: 600, letterSpacing: "0em", sample: "HEADING 2 — SECTION HEADING", usage: "Section heading", fontFamily: "var(--font-family-acme)", transform: "uppercase" },
          { name: "H3", sizeDesktop: "22px", sizeMobile: "20px", lineHeight: 1.25, lineHeightMobile: 1.25, weight: 600, letterSpacing: "0em", sample: "Heading 3 — Subsection heading", usage: "Subsection heading", fontFamily: "var(--font-family-tight)" }
        ]
      },
      {
        title: "Subheadings",
        items: [
          { name: "H4", sizeDesktop: "18px", sizeMobile: "16px", lineHeight: 1.33, lineHeightMobile: 1.33, weight: 500, letterSpacing: "-0.2px", sample: "H4 — Prominent subheading", usage: "Prominent subheading", fontFamily: "var(--font-family-sans)" },
          { name: "Subtitle", sizeDesktop: "20px", sizeMobile: "16px", lineHeight: 1.33, lineHeightMobile: 1.33, weight: 400, letterSpacing: "-0.1px", sample: "Subtitle — Standard subheading", usage: "Standard subheading", fontFamily: "var(--font-family-sans)" },
          { name: "Overline", sizeDesktop: "14px", sizeMobile: "13px", lineHeight: 1.5, lineHeightMobile: 1.5, weight: 500, letterSpacing: "0.3px", sample: "OVERLINE — SECTION LABEL", usage: "Optional; section labels / metadata", fontFamily: "var(--font-family-sans)", transform: "uppercase" }
        ]
      },
      {
        title: "Body",
        items: [
          { name: "Body / L", sizeDesktop: "20px", sizeMobile: "16px", lineHeight: 1.3, lineHeightMobile: 1.33, weight: 400, letterSpacing: "-0.2px", sample: "When your teen starts driving, everything changes. Miles helps families stay calm, informed, and prepared — without constant check-ins or invasive tracking.", usage: "Intro / lead text", fontFamily: "var(--font-family-sans)" },
          { name: "Body / M", sizeDesktop: "16px", sizeMobile: "16px", lineHeight: 1.5, lineHeightMobile: 1.5, weight: 400, letterSpacing: "-0.015em", sample: "Body Medium — Default body text", usage: "Default body text", fontFamily: "var(--font-family-sans)" },
          { name: "Body / M Bold", sizeDesktop: "16px", sizeMobile: "14px", lineHeight: 1.4, lineHeightMobile: 1.4, weight: 600, letterSpacing: "-0.015em", sample: "Body Medium Bold — Emphasis text", usage: "Emphasis within body copy", fontFamily: "var(--font-family-sans)" },
          { name: "Body / S", sizeDesktop: "14px", sizeMobile: "14px", lineHeight: 1.35, lineHeightMobile: 1.35, weight: 400, letterSpacing: "-0.005em", sample: "Body Small — Secondary or dense content", usage: "Secondary or dense content", fontFamily: "var(--font-family-sans)" },
          { name: "Body / S Bold", sizeDesktop: "14px", sizeMobile: "14px", lineHeight: 1.35, lineHeightMobile: 1.35, weight: 600, letterSpacing: "-0.005em", sample: "Body Small Bold — Compact emphasis", usage: "Emphasis in dense content", fontFamily: "var(--font-family-sans)" },
          { name: "Caption", sizeDesktop: "12px", sizeMobile: "12px", lineHeight: 1.5, lineHeightMobile: 1.5, weight: 500, letterSpacing: "0.01em", sample: "Caption — Helper text or footnotes", usage: "Captions, helper text, footnotes", fontFamily: "var(--font-family-sans)" }
        ]
      },
      {
        title: "UI Text",
        items: [
          { name: "Label", sizeDesktop: "13px", sizeMobile: "11px", lineHeight: 1.33, lineHeightMobile: 1.33, weight: 400, letterSpacing: "0.01em", sample: "Label — Form labels and table headers", usage: "Form labels, table headers", fontFamily: "var(--font-family-sans)" },
          { name: "Button", sizeDesktop: "16px", sizeMobile: "16px", lineHeight: 1.5, lineHeightMobile: 1.5, weight: 600, letterSpacing: "0.01em", sample: "Button — Primary CTA", usage: "Primary button text", fontFamily: "var(--font-family-sans)" }
        ]
      },
      {
        title: "Technical",
        items: []
      }
    ];

    // Use imported data, fallback to inline data if import failed
    const finalFontFamilies = fontFamilies || fontFamiliesFallback;
    const finalTypeCatalog = typeCatalog || typeCatalogFallback;
    const finalFamilyLabels = familyLabels || new Map([
      ["var(--font-family-acme)", "Acme Gothic Condensed"],
      ["var(--font-family-tight)", "Inter Tight"],
      ["var(--font-family-mono)", "Mono"],
      ["var(--font-family-sans)", "Inter"]
    ]);

    const finalFamilyValueByVar = familyValueByVar || new Map([
      ["var(--font-family-acme)", `"Acme Gothic Condensed","Inter Tight","Inter",ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif`],
      ["var(--font-family-tight)", `"Inter Tight","Inter",ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif`],
      ["var(--font-family-sans)", `"Inter",ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif`],
      ["var(--font-family-mono)", `ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace`]
    ]);

    const finalGoogleSlidesAlternatives = googleSlidesAlternatives || new Map([
      ["var(--font-family-acme)", { name: "Special Gothic Condensed One", css: "'Special Gothic Condensed One', sans-serif", notes: "Condensed display font available in Google Slides", weight: 400 }],
      ["var(--font-family-special)", { name: "Special Gothic Condensed One", css: "'Special Gothic Condensed One', sans-serif", notes: "Condensed display font available in Google Slides", weight: 400 }],
      ["var(--font-family-tight)", { name: "Inter", css: "'Inter', sans-serif", notes: "Available in Google Slides" }],
      ["var(--font-family-sans)", { name: "Inter", css: "'Inter', sans-serif", notes: "Available in Google Slides" }],
      ["var(--font-family-mono)", { name: "Roboto Mono", css: "'Roboto Mono', monospace", notes: "Monospace font available in Google Slides" }]
    ]);

    function getDisplayFamily(fontFamily, mode = typeMode) {
      if (mode === "google-slides") {
        const alt = finalGoogleSlidesAlternatives.get(fontFamily);
        return alt ? alt.css : fontFamily;
      }
      return fontFamily;
    }

    function getDisplayFamilyLabel(fontFamily, mode = typeMode) {
      if (mode === "google-slides") {
        const alt = finalGoogleSlidesAlternatives.get(fontFamily);
        return alt ? alt.name : getFamilyLabel(fontFamily);
      }
      return getFamilyLabel(fontFamily);
    }

    function getDisplayWeight(style, mode = typeMode) {
      if (mode === "google-slides") {
        const alt = finalGoogleSlidesAlternatives.get(style.fontFamily || "var(--font-family-sans)");
        if (alt?.weight) return alt.weight;
      }
      return style.weight;
    }

    function getFamilyLabel(value) {
      return finalFamilyLabels.get(value) || "Inter";
    }

    function findStyleByName(name) {
      for (const group of finalTypeCatalog) {
        for (const item of group.items) {
          if (item.name === name) return item;
        }
      }
      return null;
    }

    let typeMode = "desktop";
    let tableRows = [];

    function buildInlineStyle(style, mode = typeMode) {
      const sizeDesktop = style.sizeDesktop || style.size;
      const sizeMobile = style.sizeMobile || sizeDesktop;
      const lineHeightDesktop = style.lineHeight;
      const lineHeightMobile = style.lineHeightMobile || lineHeightDesktop;
      // For google-slides mode, use desktop sizes but alternative fonts
      const effectiveSizeMode = mode === "google-slides" ? "desktop" : mode;
      const size = effectiveSizeMode === "mobile" ? sizeMobile : sizeDesktop;
      const lineHeight = effectiveSizeMode === "mobile" ? lineHeightMobile : lineHeightDesktop;
      
      // Use Google Slides font if in that mode
      const fontFamily = getDisplayFamily(style.fontFamily || "var(--font-family-sans)", mode);

      const weight = getDisplayWeight(style, mode);

      return [
        `font-family: ${fontFamily}`,
        `font-size: ${size}`,
        `line-height: ${lineHeight}`,
        `font-weight: ${weight}`,
        `letter-spacing: ${style.letterSpacing}`,
        style.transform ? `text-transform: ${style.transform}` : ""
      ].filter(Boolean).join("; ");
    }

    function buildCssBlock(style) {
      const sizeDesktop = style.sizeDesktop || style.size;
      const sizeMobile = style.sizeMobile || sizeDesktop;
      const lineHeightDesktop = style.lineHeight;
      const lineHeightMobile = style.lineHeightMobile || lineHeightDesktop;

      const block = [
        `font-family: ${style.fontFamily || "var(--font-family-sans)"};`,
        `font-size: ${sizeDesktop};`,
        `line-height: ${lineHeightDesktop};`,
        `font-weight: ${style.weight};`,
        `letter-spacing: ${style.letterSpacing};`,
        style.transform ? `text-transform: ${style.transform};` : ""
      ].filter(Boolean);

      if (sizeMobile && (sizeMobile !== sizeDesktop || lineHeightMobile !== lineHeightDesktop)) {
        block.push(`@media (max-width: 640px) {`);
        block.push(`  font-size: ${sizeMobile};`);
        block.push(`  line-height: ${lineHeightMobile};`);
        block.push(`}`);
      }

      return block.join("\n");
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch {
        // Fallback for older browsers / restricted contexts
        const el = document.createElement("textarea");
        el.value = text;
        el.setAttribute("readonly", "");
        el.style.position = "fixed";
        el.style.top = "-9999px";
        document.body.appendChild(el);
        el.select();
        const ok = document.execCommand("copy");
        document.body.removeChild(el);
        return ok;
      }
    }

    function renderFontFamilies() {
      const container = document.getElementById("fontFamilies");
      if (!container) return;

      // Always show all font families regardless of view mode
      const families = finalFontFamilies;

      container.innerHTML = families.map((family) => {
        const weightChips = (family.weights || [])
          .map(w => `<li class="chip">${w}</li>`)
          .join("");

        let resourceBtn;
        if (family.resourceUrl && family.isDownload) {
          // Direct download link
          const downloadBtn = `<a href="${family.resourceUrl}" download class="action-btn" style="text-decoration: none; display: inline-flex; align-items: center; gap: 4px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Download font
            </a>`;
          let externalBtn = "";
          if (family.secondaryResourceUrl) {
            externalBtn = `<a href="${family.secondaryResourceUrl}" target="_blank" rel="noopener noreferrer" class="action-btn" style="text-decoration: none; display: inline-flex; align-items: center; gap: 4px;">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                  <polyline points="15 3 21 3 21 9"></polyline>
                  <line x1="10" y1="14" x2="21" y2="3"></line>
                </svg>
                View on Google Fonts
              </a>`;
          }
          resourceBtn = `${downloadBtn}${externalBtn ? ` ${externalBtn}` : ""}`;
        } else if (family.resourceUrl) {
          // External resource link
          resourceBtn = `<a href="${family.resourceUrl}" target="_blank" rel="noopener noreferrer" class="action-btn" style="text-decoration: none; display: inline-flex; align-items: center; gap: 4px;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                <polyline points="15 3 21 3 21 9"></polyline>
                <line x1="10" y1="14" x2="21" y2="3"></line>
              </svg>
              Get font
            </a>`;
        } else {
          resourceBtn = `<span class="action-btn" style="opacity: 0.5; cursor: default;">No resource available</span>`;
        }

        return `
          <section class="family-card" aria-label="Font family ${family.name}">
            <div class="family-header">
              <h3 class="family-name">${family.name}</h3>
              <div class="family-var">${family.variable}</div>
            </div>
            <p class="family-sample" style="font-family: ${family.css};${family.sampleTransform ? ` text-transform: ${family.sampleTransform};` : ''}">${family.sample || ""}</p>
            <ul class="chips" aria-label="${family.name} available weights">
              ${weightChips}
            </ul>
            <div class="family-meta">
              <div><strong>Style:</strong> ${family.blurb || ""}</div>
              <div><strong>Referencing:</strong> ${family.references || ""}</div>
              <div><strong>Used best for:</strong> ${family.bestFor || ""}</div>
            </div>
            <div class="family-actions" style="margin-top: 8px;">
              ${resourceBtn}
            </div>
          </section>
        `;
      }).join("");
    }

    function renderTypeTable() {
      const tbody = document.getElementById("typeTableBody");
      if (!tbody) return;

      let idx = 0;
      const rows = finalTypeCatalog.flatMap(group =>
        group.items.map(item => ({
          ...item,
          __index: idx++
        }))
      );

      tableRows = rows;

      tbody.innerHTML = rows
        .map((row) => {
          const sizeDesktop = row.sizeDesktop || row.size || "";
          const sizeMobile = row.sizeMobile || sizeDesktop;
          // For google-slides mode, use desktop sizes
          const effectiveSizeMode = typeMode === "google-slides" ? "desktop" : typeMode;
          const size = effectiveSizeMode === "mobile" ? sizeMobile : sizeDesktop;
          const lineHeight = effectiveSizeMode === "mobile" ? (row.lineHeightMobile || row.lineHeight) : row.lineHeight;
          const weight = getDisplayWeight(row, typeMode);
          const familyLabel = getDisplayFamilyLabel(row.fontFamily, typeMode);

          return `
          <tr>
            <td>${row.name}</td>
            <td><div class="sample" data-style-name="${row.name}" style="${buildInlineStyle(row)}">${row.sample || row.name}</div></td>
            <td class="mono">${familyLabel}</td>
            <td class="mono">${size}</td>
            <td class="mono">${weight}</td>
            <td class="mono">${lineHeight}</td>
            <td class="mono">${row.letterSpacing}</td>
            <td class="subtle">${row.usage || ""}</td>
            <td>
              <div style="display:flex; gap:6px; flex-wrap:wrap;">
                <button
                  type="button"
                  class="action-btn"
                  data-copy-css="${encodeURIComponent(buildCssBlock(row))}"
                  aria-label="Copy CSS style for ${row.name}"
                >Copy CSS</button>
                <button
                  type="button"
                  class="action-btn admin-only"
                  style="${window.__USER_IS_ADMIN__ ? '' : 'display:none;'}"
                  data-preview-index="${row.__index}"
                  aria-label="Preview ${row.name}"
                >Preview</button>
                <button
                  type="button"
                  class="action-btn admin-only"
                  style="${window.__USER_IS_ADMIN__ ? '' : 'display:none;'}"
                  data-edit-index="${row.__index}"
                  aria-label="Edit ${row.name}"
                >Edit</button>
                <button
                  type="button"
                  class="action-btn admin-only"
                  style="${window.__USER_IS_ADMIN__ ? '' : 'display:none;'}"
                  data-popout-index="${row.__index}"
                  aria-label="Pop out ${row.name}"
                >Pop out</button>
              </div>
            </td>
          </tr>
        `;
        })
        .join("");
    }

    document.addEventListener("click", async (event) => {
      const btn = event.target.closest("[data-copy-css]");
      if (!btn) return;

      const css = decodeURIComponent(btn.getAttribute("data-copy-css") || "");
      if (!css) return;

      const ok = await copyToClipboard(css);
      const original = btn.textContent;
      btn.textContent = ok ? "Copied" : "Copy failed";
      btn.disabled = true;
      window.setTimeout(() => {
        btn.textContent = original;
        btn.disabled = false;
      }, 900);
    });

    function openPreview(index) {
      const row = tableRows.find(r => r.__index === index);
      if (!row) return;

      const modal = document.getElementById("modal");
      const titleEl = document.getElementById("modalTitle");
      const sampleEl = document.getElementById("modalSample");
      const metaEl = document.getElementById("modalMeta");
      if (!modal || !titleEl || !sampleEl || !metaEl) return;

      const sizeDesktop = row.sizeDesktop || row.size || "";
      const sizeMobile = row.sizeMobile || sizeDesktop;
      const lineHeightDesktop = row.lineHeight;
      const lineHeightMobile = row.lineHeightMobile || lineHeightDesktop;
      // For google-slides mode, use desktop sizes
      const effectiveSizeMode = typeMode === "google-slides" ? "desktop" : typeMode;
      const size = effectiveSizeMode === "mobile" ? sizeMobile : sizeDesktop;
      const lineHeight = effectiveSizeMode === "mobile" ? lineHeightMobile : lineHeightDesktop;
      const weight = getDisplayWeight(row, typeMode);
      const familyLabel = getDisplayFamilyLabel(row.fontFamily, typeMode);

      titleEl.textContent = `${row.name} • ${familyLabel}`;
      sampleEl.textContent = row.sample || row.name;
      sampleEl.setAttribute("style", buildInlineStyle(row));

      const modeLabels = {
        "desktop": "Desktop",
        "mobile": "Mobile",
        "google-slides": "Google Slides"
      };

      metaEl.innerHTML = `
        <div><dt>Family</dt><dd>${familyLabel}</dd></div>
        <div><dt>Mode</dt><dd>${modeLabels[typeMode] || "Desktop"}</dd></div>
        <div><dt>Size</dt><dd>${size}</dd></div>
        <div><dt>Weight</dt><dd>${weight}</dd></div>
        <div><dt>Line-height</dt><dd>${lineHeight}</dd></div>
        <div><dt>Tracking</dt><dd>${row.letterSpacing}</dd></div>
        <div><dt>Usage</dt><dd>${row.usage || ""}</dd></div>
      `;

      modal.setAttribute("aria-hidden", "false");
      modal.classList.add("show");
    }

    function closeModal() {
      const modal = document.getElementById("modal");
      if (!modal) return;
      modal.classList.remove("show");
      modal.setAttribute("aria-hidden", "true");
    }

    document.addEventListener("click", (event) => {
      const previewBtn = event.target.closest("[data-preview-index]");
      if (previewBtn) {
        const index = Number(previewBtn.getAttribute("data-preview-index"));
        openPreview(index);
        return;
      }
      if (event.target.id === "modal") {
        closeModal();
        return;
      }
      if (event.target.id === "editModal") {
        closeEditModal();
      }
    });

    document.getElementById("modalClose")?.addEventListener("click", closeModal);

    document.addEventListener("keydown", (event) => {
      if (event.key === "Escape") {
        closeModal();
        closeEditModal();
      }
    });

    const modeSelect = document.getElementById("typeMode");

    document.getElementById("typeMode")?.addEventListener("change", (event) => {
      const value = event.target.value;
      typeMode = ["mobile", "google-slides"].includes(value) ? value : "desktop";
      renderTypeTable();
      // Font families don't change with view mode
    });

    function buildTypeCsv() {
      const headers = ["Style", "Sample", "Family", "Size", "Weight", "Line Height", "Tracking", "Usage", "All Caps"];
      const rows = tableRows.map((row) => {
        const sizeDesktop = row.sizeDesktop || row.size || "";
        const sizeMobile = row.sizeMobile || sizeDesktop;
        const size = typeMode === "mobile" ? sizeMobile : sizeDesktop;
        const lineHeight = typeMode === "mobile" ? (row.lineHeightMobile || row.lineHeight) : row.lineHeight;
        const familyLabel = getFamilyLabel(row.fontFamily);
        const allCaps = (row.transform || "").toLowerCase() === "uppercase" ? "TRUE" : "FALSE";
        return [
          row.name,
          row.sample || "",
          familyLabel,
          size,
          row.weight,
          lineHeight,
          row.letterSpacing,
          row.usage || "",
          allCaps
        ];
      });

      const escapeCell = (value) => {
        const text = value == null ? "" : String(value);
        const escaped = text.replace(/"/g, '""');
        return `"${escaped}"`;
      };

      return [headers, ...rows]
        .map(cells => cells.map(escapeCell).join(","))
        .join("\n");
    }

    function downloadTypeScaleCsv() {
      const csv = buildTypeCsv();
      const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = `type-scale-${typeMode}.csv`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    document.getElementById("downloadTypeCsv")?.addEventListener("click", downloadTypeScaleCsv);

    let editIndex = null;
    const editModal = document.getElementById("editModal");
    const editModalTitle = document.getElementById("editModalTitle");
    const editForm = document.getElementById("editForm");
    const editFamily = document.getElementById("editFamily");
    const editWeight = document.getElementById("editWeight");
    const editTracking = document.getElementById("editTracking");
    const editAllCaps = document.getElementById("editAllCaps");
    const editSizeDesktopValue = document.getElementById("editSizeDesktopValue");
    const editSizeDesktopUnit = document.getElementById("editSizeDesktopUnit");
    const editSizeMobileValue = document.getElementById("editSizeMobileValue");
    const editSizeMobileUnit = document.getElementById("editSizeMobileUnit");
    const editLineHeightDesktop = document.getElementById("editLineHeightDesktop");
    const editLineHeightMobile = document.getElementById("editLineHeightMobile");
    const editSample = document.getElementById("editSample");
    const editUsage = document.getElementById("editUsage");

    // Helper function to parse size string (e.g., "48px") into value and unit
    function parseSizeString(sizeStr) {
      if (!sizeStr) return { value: "", unit: "px" };
      const match = String(sizeStr).match(/^([\d.]+)([a-z%]+)$/i);
      if (match) {
        return { value: match[1], unit: match[2] };
      }
      // If no unit found, assume it's just a number in px
      return { value: sizeStr, unit: "px" };
    }

    // Helper function to update step based on unit
    function updateStepForUnit(inputEl, unit) {
      if (!inputEl) return;
      // px uses whole numbers (step=1), rem/em use 1 decimal place (step=0.1)
      inputEl.step = unit === "px" ? "1" : "0.1";
    }

    // Update step when unit selector changes
    editSizeDesktopUnit?.addEventListener("change", (e) => {
      updateStepForUnit(editSizeDesktopValue, e.target.value);
    });

    editSizeMobileUnit?.addEventListener("change", (e) => {
      updateStepForUnit(editSizeMobileValue, e.target.value);
    });

    function closeEditModal() {
      if (!editModal) return;
      editModal.classList.remove("show");
      editModal.setAttribute("aria-hidden", "true");
      editIndex = null;
    }

    function openPopout(index) {
      const row = tableRows.find(r => r.__index === index);
      if (!row) return;

      const source = findStyleByName(row.name) || row;
      const sizeDesktop = source.sizeDesktop || source.size || "";
      const sizeMobile = source.sizeMobile || sizeDesktop;
      const size = typeMode === "mobile" ? sizeMobile : sizeDesktop;
      const lineHeightDesktop = source.lineHeight;
      const lineHeightMobile = source.lineHeightMobile || lineHeightDesktop;
      const lineHeight = typeMode === "mobile" ? lineHeightMobile : lineHeightDesktop;
      const weight = source.weight;
      const letterSpacing = source.letterSpacing;
      const transform = source.transform ? `text-transform: ${source.transform};` : "";
      const familyValue = finalFamilyValueByVar.get(source.fontFamily) || finalFamilyValueByVar.get("var(--font-family-sans)");

      // Build absolute URL for local font
      const fontUrl = new URL("fonts/Acme-Gothic-Condensed-Semi-Bold.otf", window.location.href).href;

      const html = `<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>${source.name} sample</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Inter+Tight:wght@100..900&display=swap" rel="stylesheet">
  <style>
    @font-face {
      font-family: "Acme Gothic Condensed";
      src: url("${fontUrl}") format("opentype");
      font-weight: 600;
      font-style: normal;
      font-display: swap;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      margin: 16px;
      background: #ffffff;
      color: #111827;
      -webkit-font-smoothing: antialiased;
    }
    .sample {
      font-family: ${familyValue};
      font-size: ${size};
      line-height: ${lineHeight};
      font-weight: ${weight};
      letter-spacing: ${letterSpacing};
      ${transform}
      outline: none;
    }
  </style>
</head>
<body>
  <div class="sample" contenteditable="true" aria-label="${source.name} sample (editable)">${source.sample || source.name}</div>
</body>
</html>`;

      const popup = window.open("", "_blank", "width=520,height=320");
      if (!popup) {
        alert("Pop-out blocked by browser. Allow pop-ups for this site.");
        return;
      }
      popup.document.open();
      popup.document.write(html);
      popup.document.close();
    }

    function openEditModal(index) {
      const row = tableRows.find(r => r.__index === index);
      if (!row || !editModal) return;
      const source = findStyleByName(row.name) || row;
      editIndex = index;
      editModalTitle.textContent = `Edit ${row.name}`;

      editFamily.value = source.fontFamily || "var(--font-family-sans)";
      editWeight.value = source.weight ?? "";
      editTracking.value = source.letterSpacing ?? "";
      editAllCaps.checked = (source.transform || "").toLowerCase() === "uppercase";
      
      // Parse desktop size
      const desktopSize = parseSizeString(source.sizeDesktop || source.size || "");
      editSizeDesktopValue.value = desktopSize.value;
      editSizeDesktopUnit.value = desktopSize.unit;
      updateStepForUnit(editSizeDesktopValue, desktopSize.unit);
      
      // Parse mobile size
      const mobileSize = parseSizeString(source.sizeMobile || source.sizeDesktop || source.size || "");
      editSizeMobileValue.value = mobileSize.value;
      editSizeMobileUnit.value = mobileSize.unit;
      updateStepForUnit(editSizeMobileValue, mobileSize.unit);
      
      editLineHeightDesktop.value = source.lineHeight ?? "";
      editLineHeightMobile.value = source.lineHeightMobile || source.lineHeight || "";
      editSample.value = source.sample || "";
      editUsage.value = source.usage || "";

      editModal.classList.add("show");
      editModal.setAttribute("aria-hidden", "false");
    }

    document.getElementById("editCancel")?.addEventListener("click", closeEditModal);
    document.getElementById("editModalClose")?.addEventListener("click", closeEditModal);

    editForm?.addEventListener("submit", (event) => {
      event.preventDefault();
      if (editIndex == null) return;
      const row = tableRows.find(r => r.__index === editIndex);
      if (!row) return;

      const style = findStyleByName(row.name) || row;
      style.fontFamily = editFamily.value || style.fontFamily || "var(--font-family-sans)";
      style.weight = Number(editWeight.value) || editWeight.value || style.weight;
      style.letterSpacing = editTracking.value || style.letterSpacing;
      style.transform = editAllCaps.checked ? "uppercase" : "";
      
      // Combine value + unit for desktop size
      const desktopValue = editSizeDesktopValue.value;
      const desktopUnit = editSizeDesktopUnit.value;
      style.sizeDesktop = desktopValue ? `${desktopValue}${desktopUnit}` : (style.sizeDesktop || style.size || "");
      
      // Combine value + unit for mobile size
      const mobileValue = editSizeMobileValue.value;
      const mobileUnit = editSizeMobileUnit.value;
      style.sizeMobile = mobileValue ? `${mobileValue}${mobileUnit}` : (style.sizeMobile || style.sizeDesktop || style.size || "");
      
      style.size = style.sizeDesktop;
      style.lineHeight = Number(editLineHeightDesktop.value) || editLineHeightDesktop.value || style.lineHeight;
      style.lineHeightMobile = Number(editLineHeightMobile.value) || editLineHeightMobile.value || style.lineHeightMobile || style.lineHeight;
      style.sample = editSample.value || style.sample;
      style.usage = editUsage.value || style.usage;

      // keep tableRows in sync for immediate preview without re-render
      Object.assign(row, style);

      renderTypeTable();
      closeEditModal();
    });

    editForm?.addEventListener("keydown", (event) => {
      if (event.key !== "Enter" || event.shiftKey || event.metaKey || event.ctrlKey || event.altKey) return;
      event.preventDefault();
      if (typeof editForm.requestSubmit === "function") {
        editForm.requestSubmit();
      } else {
        editForm.submit();
      }
    });

    document.addEventListener("click", (event) => {
      const editBtn = event.target.closest("[data-edit-index]");
      if (editBtn) {
        const index = Number(editBtn.getAttribute("data-edit-index"));
        openEditModal(index);
        return;
      }

      const popoutBtn = event.target.closest("[data-popout-index]");
      if (popoutBtn) {
        const index = Number(popoutBtn.getAttribute("data-popout-index"));
        openPopout(index);
        return;
      }
    });

    // Auto-select mode on load based on viewport.
    (function initMode() {
      const prefersMobile = window.matchMedia("(max-width: 640px)").matches;
      typeMode = prefersMobile ? "mobile" : "desktop";
      if (modeSelect) modeSelect.value = typeMode;
    })();

    renderFontFamilies();
    renderTypeTable();
  </script>
  <script>
    // Show admin controls if user is admin
    (function initAdminControls() {
      const isAdmin = window.__USER_IS_ADMIN__ || false;
      if (isAdmin) {
        document.querySelectorAll('.admin-only').forEach(el => {
          el.style.display = '';
        });
      }
    })();
  </script>
  <script src="sidebar-nav.js"></script>
</body>
</html>
