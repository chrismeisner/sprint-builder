<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>First Trip Journey ‚Äì Miles Styleguide</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Inter+Tight:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="tokens.css" />
  <link rel="stylesheet" href="base.css" />
  <link rel="stylesheet" href="typography-styles.css" />
  <link rel="stylesheet" href="journey-carousel.css" />
  <link rel="stylesheet" href="sidebar-nav.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font-family-sans);
      background: var(--neutral-50);
      color: var(--neutral-900);
      -webkit-font-smoothing: antialiased;
      opacity: 0;
      animation: globalFadeIn 600ms ease forwards;
    }

    @keyframes globalFadeIn {
      to { opacity: 1; }
    }

    .wrap {
      max-width: 1400px;
      margin: auto;
      padding: 32px 16px 64px;
    }

    .page-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 24px;
    }

    .page-header-content {
      flex: 1;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .breadcrumb a {
      color: var(--neutral-500);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      color: var(--brand-primary-600);
      text-decoration: underline;
    }

    .breadcrumb-separator {
      color: var(--neutral-400);
    }

    .breadcrumb-current {
      color: var(--neutral-700);
      font-weight: 500;
    }

    h1 {
      margin: 0 0 8px;
      font-family: var(--font-family-sans);
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .journey-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
      background: var(--brand-primary-100);
      color: var(--brand-primary-700);
    }

    .subtitle {
      font-family: var(--font-family-sans);
      font-size: 15px;
      font-weight: 400;
      color: var(--neutral-600);
      margin: 0;
      line-height: 1.5;
    }

    .page-actions {
      display: flex;
      gap: 8px;
      flex-shrink: 0;
    }

    .export-btn {
      display: none; /* Hidden by default, shown only for admins */
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 8px;
      border: 1px solid var(--neutral-200);
      background: var(--neutral-0);
      font-family: var(--font-family-sans);
      font-size: 13px;
      font-weight: 600;
      color: var(--neutral-700);
      cursor: pointer;
      transition: all 150ms ease;
    }

    .export-btn.admin-visible {
      display: inline-flex;
    }

    .export-btn:hover {
      border-color: var(--brand-primary-400);
      color: var(--brand-primary-600);
      background: var(--brand-primary-50);
    }

    .export-btn svg {
      width: 16px;
      height: 16px;
    }

    @media (max-width: 500px) {
      .page-header {
        flex-direction: column;
      }
      .page-actions {
        display: none;
      }
    }

    /* User Modal */
    .user-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.2s ease, visibility 0.2s ease;
      padding: 16px;
    }

    .user-modal-overlay.visible {
      opacity: 1;
      visibility: visible;
    }

    .user-modal {
      background: var(--neutral-0);
      border-radius: var(--radius);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      max-width: 480px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      transform: translateY(20px);
      transition: transform 0.2s ease;
      position: relative;
    }

    .user-modal-overlay.visible .user-modal {
      transform: translateY(0);
    }

    .user-modal-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      padding: 28px 24px 24px;
      background: linear-gradient(135deg, var(--brand-primary-50) 0%, var(--neutral-50) 100%);
      border-bottom: 1px solid var(--neutral-100);
      text-align: center;
    }

    .user-modal-avatar {
      width: 128px;
      height: 128px;
      border-radius: 50%;
      background: var(--brand-primary-100);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 56px;
      flex-shrink: 0;
      border: 4px solid var(--neutral-0);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
      overflow: hidden;
    }

    .user-modal-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-modal-identity {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .user-modal-name {
      margin: 0 0 4px;
      font-size: 22px;
      font-weight: 700;
      color: var(--neutral-900);
    }

    .user-modal-role {
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 500;
      color: var(--brand-primary-600);
    }

    .user-modal-tags-label {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--neutral-500);
      margin-bottom: 4px;
    }

    .user-modal-tags {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 6px;
      margin-top: 4px;
    }

    .user-modal-tag {
      font-size: 11px;
      font-weight: 500;
      padding: 3px 8px;
      border-radius: 4px;
      background: var(--brand-success-100);
      color: var(--brand-success-700);
    }

    .user-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: var(--neutral-0);
      color: var(--neutral-500);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 150ms ease;
    }

    .user-modal-close:hover {
      background: var(--neutral-100);
      color: var(--neutral-700);
    }

    .user-modal-close svg {
      width: 18px;
      height: 18px;
    }

    .user-modal-quote {
      padding: 20px 24px;
      background: var(--neutral-50);
      border-bottom: 1px solid var(--neutral-100);
    }

    .user-modal-quote blockquote {
      margin: 0;
      font-size: 15px;
      font-style: italic;
      line-height: 1.5;
      color: var(--neutral-700);
      position: relative;
      padding-left: 20px;
    }

    .user-modal-quote blockquote::before {
      content: '"';
      position: absolute;
      left: 0;
      top: -4px;
      font-size: 28px;
      font-style: normal;
      color: var(--brand-primary-300);
      font-family: Georgia, serif;
    }

    .user-modal-body {
      padding: 20px 24px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .user-modal-section {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .user-modal-section-header {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .user-modal-section-icon { font-size: 16px; }

    .user-modal-section-title {
      margin: 0;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--neutral-500);
    }

    .user-modal-section-content {
      font-size: 14px;
      line-height: 1.5;
      color: var(--neutral-700);
    }

    .user-modal-section-content ul {
      margin: 0;
      padding: 0 0 0 18px;
    }

    .user-modal-section-content li {
      margin-bottom: 4px;
    }

    .user-modal-section-content li:last-child {
      margin-bottom: 0;
    }

    .user-modal-goals {
      padding: 12px 14px;
      background: var(--brand-primary-50);
      border: 1px solid var(--brand-primary-200);
      border-radius: 8px;
    }

    .user-modal-goals .user-modal-section-title { color: var(--brand-primary-700); }
    .user-modal-goals .user-modal-section-content { color: var(--brand-primary-800); }

    .user-modal-pains {
      padding: 12px 14px;
      background: var(--brand-secondary-50);
      border: 1px solid var(--brand-secondary-200);
      border-radius: 8px;
    }

    .user-modal-pains .user-modal-section-title { color: var(--brand-secondary-700); }
    .user-modal-pains .user-modal-section-content { color: var(--brand-secondary-800); }

    .user-modal-footer {
      padding: 16px 24px;
      background: var(--neutral-50);
      border-top: 1px solid var(--neutral-100);
    }

    .user-modal-stages {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .user-modal-stages-label {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--neutral-500);
    }

    .user-modal-stage-tag {
      font-size: 11px;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--brand-primary-100);
      color: var(--brand-primary-700);
    }

    .view-all-profiles {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      font-size: 13px;
      font-weight: 500;
      color: var(--brand-primary-600);
      text-decoration: none;
      transition: color 150ms ease;
    }

    .view-all-profiles:hover {
      color: var(--brand-primary-700);
      text-decoration: underline;
    }

    .view-all-profiles svg {
      width: 14px;
      height: 14px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="page-header">
      <div class="page-header-content">
        <div class="breadcrumb">
          <a href="user-journeys.html">User Journeys</a>
          <span class="breadcrumb-separator">/</span>
          <span class="breadcrumb-current">First Trip</span>
        </div>
        <h1>
          First Trip Journey
          <span class="journey-badge">Primary</span>
        </h1>
        <p class="subtitle">The core product loop: Setting up the dongle, driving hands-free, and seeing a trip summary that builds trust.</p>
      </div>
      <div class="page-actions">
        <button class="export-btn" id="downloadImagesBtn" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
          </svg>
          Download Images
        </button>
        <button class="export-btn" id="exportCsvBtn" type="button">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" y1="15" x2="12" y2="3"/>
          </svg>
          Export CSV
        </button>
      </div>
    </div>

    <!-- User Detail Modal -->
    <div class="user-modal-overlay" id="userModalOverlay">
      <div class="user-modal" role="dialog" aria-labelledby="modalUserName">
        <button class="user-modal-close" id="closeUserModal" type="button" aria-label="Close modal">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
        <div class="user-modal-header">
          <div class="user-modal-avatar" id="modalUserAvatar"></div>
          <div class="user-modal-identity">
            <h2 class="user-modal-name" id="modalUserName"></h2>
            <p class="user-modal-role" id="modalUserRole"></p>
            <div class="user-modal-tags-label">What Success Looks Like:</div>
            <div class="user-modal-tags" id="modalUserTags"></div>
          </div>
        </div>
        <div class="user-modal-quote">
          <blockquote id="modalUserQuote"></blockquote>
        </div>
        <div class="user-modal-body">
          <div class="user-modal-section user-modal-goals">
            <div class="user-modal-section-header">
              <span class="user-modal-section-icon">üéØ</span>
              <h3 class="user-modal-section-title">Must-Have Outcomes</h3>
            </div>
            <div class="user-modal-section-content">
              <ul id="modalUserGoals"></ul>
            </div>
          </div>
          <div class="user-modal-section user-modal-pains">
            <div class="user-modal-section-header">
              <span class="user-modal-section-icon">üîí</span>
              <h3 class="user-modal-section-title">Trust & Fairness Rules</h3>
            </div>
            <div class="user-modal-section-content">
              <ul id="modalUserPains"></ul>
            </div>
          </div>
          <div class="user-modal-section">
            <div class="user-modal-section-header">
              <span class="user-modal-section-icon">‚ö°</span>
              <h3 class="user-modal-section-title">Trigger Moments</h3>
            </div>
            <div class="user-modal-section-content">
              <ul id="modalUserBehaviors"></ul>
            </div>
          </div>
        </div>
        <div class="user-modal-footer">
          <div class="user-modal-stages">
            <span class="user-modal-stages-label">Default Visibility:</span>
            <div id="modalUserStages"></div>
          </div>
          <a href="profiles.html" class="view-all-profiles">
            View all user profiles
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M5 12h14M12 5l7 7-7 7"/>
            </svg>
          </a>
        </div>
      </div>
    </div>

    <!-- Journey Carousel -->
    <div class="journey-carousel" id="journeyCarousel">
      <div class="carousel-container">
        <div class="carousel-track" id="carouselTrack">
          
          <!-- Stage 1: Setup -->
          <article class="journey-stage">
            <div class="stage-image">
              <div class="stage-image-slideshow" data-interval="4000">
                <img src="./images/journey-first-trip-1a.jpg" alt="Setup stage - unboxing" data-expected-filename="journey-first-trip-1a.jpg" />
                <img src="./images/journey-first-trip-1b.jpg" alt="Setup stage - installing" data-expected-filename="journey-first-trip-1b.jpg" />
                <img src="./images/journey-first-trip-1c.jpg" alt="Setup stage - pairing" data-expected-filename="journey-first-trip-1c.jpg" />
              </div>
            </div>
            <div class="stage-header">
              <div class="stage-number">1</div>
              <h2 class="stage-name">Setup</h2>
            </div>
            <div class="stage-body">
              <div class="stage-content">
                <div class="stage-users" data-stage="1">
                  <div class="stage-users-label">Users in this step</div>
                  <div class="stage-users-list"></div>
                </div>
                <div class="stage-section">
                  <div class="stage-label">üë§ User Goal</div>
                  <p class="stage-text">Get the dongle installed and connected once, confidently, with minimal effort</p>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚úã User Actions</div>
                  <ul class="stage-list">
                    <li>Unbox package, review contents and quick-start guide</li>
                    <li>Download app, create account, grant permissions (BLE, notifications)</li>
                    <li>Add payment method (collected early, while indoors; bypassed for users who purchased device + subscription on website)</li>
                    <li>Associate a primary driver with the device (required ‚Äî trips are attributed to this driver unless told or detected otherwise)</li>
                    <li>Optionally add secondary drivers; account owner can "send invite" to other users but invite acceptance is not required (important for SMB owners where the driver may not have app access)</li>
                    <li>Go to car ‚Äî app guides user to OBD-II port location for their vehicle</li>
                    <li>Scan QR code on device to link it to account</li>
                    <li>Plug in dongle and start ignition (order TBD with vendor)</li>
                  </ul>
                </div>
                <div class="stage-section stage-section-system">
                  <div class="stage-label">‚ö°Ô∏è Miles Actions</div>
                  <ul class="stage-list">
                    <li>Capture email at sign-up for abandoned-setup recovery</li>
                    <li>Bind device ‚Üí account via QR scan + run firmware check/update</li>
                    <li>Dongle powers on from OBD + confirms "alive"</li>
                    <li>Read VIN automatically from OBD-II; fall back to camera scan if unsupported</li>
                    <li>Pull vehicle data from OBD-II: make/model, vehicle status, location, diagnostics ‚Äî gives instant feedback that Miles is plugged in and has contextual awareness of the car before the first trip</li>
                    <li>Establish baseline connectivity + readiness to detect trips</li>
                    <li>Begin 21-day free trial period</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚öôÔ∏è Touchpoints</div>
                  <ul class="stage-list">
                    <li>App onboarding (indoors)</li>
                    <li>Payment method collection</li>
                    <li>Primary driver setup + optional secondary driver invites</li>
                    <li>QR code scan</li>
                    <li>OS permission prompts</li>
                    <li>In-car install guided by app</li>
                    <li>Vehicle data confirmation screen (VIN, make/model, status)</li>
                    <li>Quick-start guide</li>
                    <li>Help center</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">Emotion</div>
                  <span class="emotion-indicator emotion-neutral">üò¨ Cautious optimism ‚Üí mild anxiety</span>
                </div>
                <div class="stage-callouts">
                  <div class="stage-callout callout-pain">
                    <span class="stage-callout-icon">‚ö†Ô∏è</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Pain Point</div>
                      <div class="stage-callout-text">"Am I doing this right?" ‚Äî OBD port location, compatibility uncertainty, too many steps, fear of breaking something</div>
                    </div>
                  </div>
                  <div class="stage-callout callout-opportunity">
                    <span class="stage-callout-icon">üí°</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Opportunity</div>
                      <div class="stage-callout-text">Indoor-first flow: maximize setup before going to the car (billing, driver assignment, permissions); show vehicle data immediately after plug-in as proof Miles is working; app guides to OBD-II port by vehicle; instant "device detected" reassurance; email capture enables follow-up if setup abandoned; 21-day trial removes commitment anxiety</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Stage 2: Trigger -->
          <article class="journey-stage">
            <div class="stage-image">
              <div class="stage-image-slideshow" data-interval="4500">
                <img src="./images/journey-first-trip-2a.jpg" alt="Trigger stage - starting to drive" data-expected-filename="journey-first-trip-2a.jpg" />
                <img src="./images/journey-first-trip-2b.jpg" alt="Trigger stage - on the road" data-expected-filename="journey-first-trip-2b.jpg" />
              </div>
            </div>
            <div class="stage-header">
              <div class="stage-number">2</div>
              <h2 class="stage-name">Trigger</h2>
            </div>
            <div class="stage-body">
              <div class="stage-content">
                <div class="stage-users" data-stage="2">
                  <div class="stage-users-label">Users in this step</div>
                  <div class="stage-users-list"></div>
                </div>
                <div class="stage-section">
                  <div class="stage-label">üë§ User Goal</div>
                  <p class="stage-text">Start driving normally without needing to remember to do anything</p>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚úã User Actions</div>
                  <ul class="stage-list">
                    <li>Start the car</li>
                    <li>Drive normally</li>
                  </ul>
                </div>
                <div class="stage-section stage-section-system">
                  <div class="stage-label">‚ö°Ô∏è Miles Actions</div>
                  <ul class="stage-list">
                    <li>Detect ignition via OBD voltage change</li>
                    <li>Begin trip recording automatically</li>
                    <li>Collect sensor data (speed, RPM, accelerometer, location)</li>
                    <li>Pull vehicle data from OBD-II (diagnostics, status, engine codes, etc.)</li>
                    <li>Transmit trip data to cloud via device's cellular radio (independent of phone)</li>
                    <li>If app is open: stream real-time trip status (live map, speed, vehicle health)</li>
                    <li>If app is closed: same data is logged and stored in cloud, accessible later</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚öôÔ∏è Touchpoints</div>
                  <ul class="stage-list">
                    <li>Car ignition/motion</li>
                    <li>Optional real-time view in app (live map, speed, health)</li>
                    <li>No interaction required</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">Emotion</div>
                  <span class="emotion-indicator emotion-positive">üòå Relief (if truly hands-off)</span>
                </div>
                <div class="stage-callouts">
                  <div class="stage-callout callout-pain">
                    <span class="stage-callout-icon">‚ö†Ô∏è</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Pain Point</div>
                      <div class="stage-callout-text">Uncertainty that it actually started logging; temptation to check phone while driving</div>
                    </div>
                  </div>
                  <div class="stage-callout callout-opportunity">
                    <span class="stage-callout-icon">üí°</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Opportunity</div>
                      <div class="stage-callout-text">Show accuracy on the first drive ‚Äî users will watch the live map closely to see if real-time data is accurate and responsive. If the dot is off or there's serious lag, it creates doubt about reliability. These early "live" moments are a big test; users will watch drives more in the beginning then taper off. Communicate clearly before the drive: "You don't need to press anything." Optionally provide a non-distracting "we've got it" signal only when parked</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Stage 3: Interpretation -->
          <article class="journey-stage">
            <div class="stage-image">
              <div class="stage-image-slideshow" data-interval="4500">
                <img src="./images/journey-first-trip-3a.jpg" alt="Interpretation stage - trip detection" data-expected-filename="journey-first-trip-3a.jpg" />
                <img src="./images/journey-first-trip-3b.jpg" alt="Interpretation stage - processing data" data-expected-filename="journey-first-trip-3b.jpg" />
              </div>
            </div>
            <div class="stage-header">
              <div class="stage-number">3</div>
              <h2 class="stage-name">Interpretation</h2>
            </div>
            <div class="stage-body">
              <div class="stage-content">
                <div class="stage-users" data-stage="3">
                  <div class="stage-users-label">Users in this step</div>
                  <div class="stage-users-list"></div>
                </div>
                <div class="stage-section">
                  <div class="stage-label">üë§ User Goal</div>
                  <p class="stage-text">Understand how Miles works. Get confidence that Miles is accurate and working quietly in the background</p>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚úã User Actions</div>
                  <ul class="stage-list">
                    <li>(No user action required)</li>
                  </ul>
                </div>
                <div class="stage-section stage-section-system">
                  <div class="stage-label">‚ö°Ô∏è Miles Actions</div>
                  <ul class="stage-list">
                    <li>Process raw sensor data into trip segments</li>
                    <li>Apply trip boundary logic (start/end thresholds)</li>
                    <li>Handle edge cases (short stops, idling, connectivity gaps)</li>
                    <li>Determine trip end when ignition off + timeout elapsed</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚öôÔ∏è Touchpoints</div>
                  <ul class="stage-list">
                    <li>Device sensing</li>
                    <li>Background app services</li>
                    <li>Backend processing</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">Emotion</div>
                  <span class="emotion-indicator emotion-neutral">ü§û Invisible trust-building (or skepticism if flaky)</span>
                </div>
                <div class="stage-callouts">
                  <div class="stage-callout callout-pain">
                    <span class="stage-callout-icon">‚ö†Ô∏è</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Pain Point</div>
                      <div class="stage-callout-text">Missed trips, split trips, or weird boundaries (short stops, idling, intermittent connectivity)</div>
                    </div>
                  </div>
                  <div class="stage-callout callout-opportunity">
                    <span class="stage-callout-icon">üí°</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Opportunity</div>
                      <div class="stage-callout-text">Graceful trip-boundary logic (start/end thresholds); "we're finalizing your trip" messaging vs errors; trip naming/tagging (e.g. "work", "school") to enable comparisons and AI insights: "your average drive to school takes 15 min", "you've used X gas on trips to work"</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Stage 4: Action -->
          <article class="journey-stage">
            <div class="stage-image">
              <div class="stage-image-slideshow" data-interval="5000">
                <img src="./images/journey-first-trip-4a.jpg" alt="Action stage - syncing" data-expected-filename="journey-first-trip-4a.jpg" />
                <img src="./images/journey-first-trip-4b.jpg" alt="Action stage - processing" data-expected-filename="journey-first-trip-4b.jpg" />
              </div>
            </div>
            <div class="stage-header">
              <div class="stage-number">4</div>
              <h2 class="stage-name">Action</h2>
            </div>
            <div class="stage-body">
              <div class="stage-content">
                <div class="stage-users" data-stage="4">
                  <div class="stage-users-label">Users in this step</div>
                  <div class="stage-users-list"></div>
                </div>
                <div class="stage-section">
                  <div class="stage-label">üë§ User Goal</div>
                  <p class="stage-text">Turn the drive into a usable artifact (not raw data)</p>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚úã User Actions</div>
                  <ul class="stage-list">
                    <li>Park the car</li>
                    <li>Optionally open app to review trip</li>
                  </ul>
                </div>
                <div class="stage-section stage-section-system">
                  <div class="stage-label">‚ö°Ô∏è Miles Actions</div>
                  <ul class="stage-list">
                    <li>Trip data already transmitted to cloud via device cellular radio</li>
                    <li>Process and finalize trip boundaries and data</li>
                    <li>Generate trip summary, scores, and basic insights</li>
                    <li>Make trip available in app with full details</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚öôÔ∏è Touchpoints</div>
                  <ul class="stage-list">
                    <li>Cloud processing</li>
                    <li>Push notification when first trip is complete (and possibly a few early drives)</li>
                    <li>Prompt to customize alert preferences: get alert for each drive, get alert only for drives with issues (driving events, vehicle issues), no alert but daily/weekly email summary</li>
                    <li>Trip detail view</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">Emotion</div>
                  <span class="emotion-indicator emotion-positive">ü§î Curious + interested ‚Äî surprised by simplicity, interested to see data, confident Miles captured it correctly. Leads them to wonder what else Miles can do</span>
                </div>
                <div class="stage-callouts">
                  <div class="stage-callout callout-pain">
                    <span class="stage-callout-icon">‚ö†Ô∏è</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Pain Point</div>
                      <div class="stage-callout-text">Big trust-buster: inaccuracy in the trip summary. Must nail this. If the first result doesn't match what they just drove, confidence drops immediately. Latency is secondary ‚Äî accuracy is the make-or-break</div>
                    </div>
                  </div>
                  <div class="stage-callout callout-opportunity">
                    <span class="stage-callout-icon">üí°</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Opportunity</div>
                      <div class="stage-callout-text">Transparent progress state ("Saving / Summarizing"); set expectations ("Trips appear shortly after you park"); data already in cloud ‚Äî no user action needed for sync; per-trip notifications will get annoying quickly ‚Äî prompt early to let users customize their alert cadence</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Stage 5: Resolution -->
          <article class="journey-stage">
            <div class="stage-image">
              <div class="stage-image-slideshow" data-interval="4500">
                <img src="./images/journey-first-trip-5a.jpg" alt="Resolution stage - viewing trip" data-expected-filename="journey-first-trip-5a.jpg" />
                <img src="./images/journey-first-trip-5b.jpg" alt="Resolution stage - trip details" data-expected-filename="journey-first-trip-5b.jpg" />
              </div>
            </div>
            <div class="stage-header">
              <div class="stage-number">5</div>
              <h2 class="stage-name">Resolution</h2>
            </div>
            <div class="stage-body">
              <div class="stage-content">
                <div class="stage-users" data-stage="5">
                  <div class="stage-users-label">Users in this step</div>
                  <div class="stage-users-list"></div>
                </div>
                <div class="stage-section">
                  <div class="stage-label">üë§ User Goal</div>
                  <p class="stage-text">See proof it worked + a helpful summary that feels encouraging</p>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚úã User Actions</div>
                  <ul class="stage-list">
                    <li>Open app</li>
                    <li>View first Trip card</li>
                    <li>Tap into trip details</li>
                    <li>Optionally reassign trip to a different driver (if someone else was driving)</li>
                  </ul>
                </div>
                <div class="stage-section stage-section-system">
                  <div class="stage-label">‚ö°Ô∏è Miles Actions</div>
                  <ul class="stage-list">
                    <li>Compile trip into viewable card format</li>
                    <li>Calculate scores, metrics, or highlights</li>
                    <li>Render map route and trip timeline</li>
                    <li>Queue "first trip complete" celebration if applicable</li>
                    <li>Allow driver reassignment on trip detail screen</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚öôÔ∏è Touchpoints</div>
                  <ul class="stage-list">
                    <li>App home / Trips view</li>
                    <li>Trip detail screen</li>
                    <li>Optional "share" affordance</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">Emotion</div>
                  <span class="emotion-indicator emotion-positive">üòä Satisfaction + confidence</span>
                </div>
                <div class="stage-callouts">
                  <div class="stage-callout callout-pain">
                    <span class="stage-callout-icon">‚ö†Ô∏è</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Pain Point</div>
                      <div class="stage-callout-text">If the first result is empty, overly technical, or judgmental, the user churns</div>
                    </div>
                  </div>
                  <div class="stage-callout callout-opportunity">
                    <span class="stage-callout-icon">üí°</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Opportunity</div>
                      <div class="stage-callout-text">Make the first Trip card a "receipt of value" (simple, legible); supportive tone; highlight wins; if something's missing, say what's still processing‚Äînot "error"</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </article>

          <!-- Stage 6: Follow Up -->
          <article class="journey-stage">
            <div class="stage-image">
              <div class="stage-image-slideshow" data-interval="4500">
                <img src="./images/journey-first-trip-6a.jpg" alt="Follow up stage - building habit" data-expected-filename="journey-first-trip-6a.jpg" />
                <img src="./images/journey-first-trip-6b.jpg" alt="Follow up stage - deepening engagement" data-expected-filename="journey-first-trip-6b.jpg" />
              </div>
            </div>
            <div class="stage-header">
              <div class="stage-number">6</div>
              <h2 class="stage-name">Follow Up</h2>
            </div>
            <div class="stage-body">
              <div class="stage-content">
                <div class="stage-users" data-stage="6">
                  <div class="stage-users-label">Users in this step</div>
                  <div class="stage-users-list"></div>
                </div>
                <div class="stage-section">
                  <div class="stage-label">üë§ User Goal</div>
                  <p class="stage-text">Build habit + deepen setup without regret or overwhelm</p>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚úã User Actions</div>
                  <ul class="stage-list">
                    <li>Drive again</li>
                    <li>Optionally complete deferred setup (name locations, customize preferences)</li>
                    <li>Add household members, set preferences</li>
                    <li>Respond to gentle nudges</li>
                  </ul>
                </div>
                <div class="stage-section stage-section-system">
                  <div class="stage-label">‚ö°Ô∏è Miles Actions</div>
                  <ul class="stage-list">
                    <li>Prompt for continued setup / customization ‚Äî surface naturally so users understand that investing a little effort (naming locations, etc.) unlocks more value</li>
                    <li>Show setup completion status on app dashboard (things still to be completed)</li>
                    <li>Track driving patterns over time</li>
                    <li>Generate weekly/monthly insights and trends</li>
                    <li>Manage notification frequency based on engagement</li>
                    <li>Monitor device health + connectivity status</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">‚öôÔ∏è Touchpoints</div>
                  <ul class="stage-list">
                    <li>Push notifications</li>
                    <li>In-app nudges</li>
                    <li>Setup completion checklist on dashboard</li>
                    <li>Weekly recap</li>
                    <li>Settings</li>
                    <li>Support</li>
                    <li>Email receipts</li>
                  </ul>
                </div>
                <div class="stage-section">
                  <div class="stage-label">Emotion</div>
                  <span class="emotion-indicator emotion-positive">ü§ù Growing trust (or annoyance if naggy)</span>
                </div>
                <div class="stage-callouts">
                  <div class="stage-callout callout-pain">
                    <span class="stage-callout-icon">‚ö†Ô∏è</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Pain Point</div>
                      <div class="stage-callout-text">Too many prompts; unclear long-term value; perceived surveillance/punitive vibe</div>
                    </div>
                  </div>
                  <div class="stage-callout callout-opportunity">
                    <span class="stage-callout-icon">üí°</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Opportunity</div>
                      <div class="stage-callout-text">Progressive disclosure: ask for more only when it unlocks value; "finish later" pathways; reinforce trust + control; show trend-based insights after a few trips without overpromising day one. Give users milestones to "stick with it" and get over the hump</div>
                    </div>
                  </div>
                  <div class="stage-callout callout-opportunity">
                    <span class="stage-callout-icon">üîÆ</span>
                    <div class="stage-callout-content">
                      <div class="stage-callout-label">Future Consideration: Parental Access Ramp-Down</div>
                      <div class="stage-callout-text">Recommended phased path for teen driver accounts (to discuss):
                        <strong>Phase 0 (Driver's Training)</strong> ‚Äî Parent sees everything. Miles logs training hours and produces report.
                        <strong>Phase 1 (First 90 Days)</strong> ‚Äî Parent sees trip-level summaries, gets more alerts. Generate driver score at end of 90 days.
                        <strong>Phase 2 (Good Record Sustained)</strong> ‚Äî Parent sees weekly rollups, teen gets more granular control.
                        <strong>Phase 3</strong> ‚Äî Teen can request "independence mode."
                        Not overly strict ‚Äî a recommended path with milestones that encourage continued use.</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </article>

        </div>
      </div>

      <div class="carousel-controls">
        <button class="carousel-btn" id="prevBtn" aria-label="Previous stage">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"/>
          </svg>
        </button>
        <div class="carousel-dots" id="carouselDots"></div>
        <button class="carousel-btn" id="nextBtn" aria-label="Next stage">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
    </div>

  </div>
  <script src="sidebar-nav.js"></script>
  <script src="personas-data.js"></script>
  <script>
    // Show export button only for admin users
    (function() {
      const isAdmin = window.__USER_IS_ADMIN__ === true;
      if (isAdmin) {
        const exportBtn = document.getElementById('exportCsvBtn');
        if (exportBtn) {
          exportBtn.classList.add('admin-visible');
        }
      }
    })();

    // Download Images functionality
    (async function() {
      const downloadBtn = document.getElementById('downloadImagesBtn');
      if (!downloadBtn) return;

      // Show the button for everyone (not admin-only)
      downloadBtn.classList.add('admin-visible');

      downloadBtn.addEventListener('click', async function() {
        try {
          // Disable button during download
          downloadBtn.disabled = true;
          downloadBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          Creating Zip...`;

          // Collect all image URLs from the page
          const images = document.querySelectorAll('.stage-image-slideshow img');
          const imageUrls = Array.from(images).map(img => ({
            src: img.src,
            filename: img.getAttribute('data-expected-filename') || img.src.split('/').pop()
          }));

          if (imageUrls.length === 0) {
            alert('No images found on this page.');
            return;
          }

          // Create a new JSZip instance
          const zip = new JSZip();
          let loaded = 0;

          // Fetch and add each image to the zip
          for (const {src, filename} of imageUrls) {
            try {
              const response = await fetch(src);
              const blob = await response.blob();
              zip.file(filename, blob);
              loaded++;
              
              // Update button with progress
              downloadBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
              Zipping ${loaded}/${imageUrls.length}...`;
            } catch (err) {
              console.error(`Failed to fetch ${filename}:`, err);
            }
          }

          // Generate the zip file
          downloadBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"/>
            <path d="M12 6v6l4 2"/>
          </svg>
          Finalizing...`;
          
          const zipBlob = await zip.generateAsync({type: 'blob'});
          
          // Download the zip file
          const url = window.URL.createObjectURL(zipBlob);
          const a = document.createElement('a');
          a.style.display = 'none';
          a.href = url;
          a.download = 'journey-first-trip-images.zip';
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);

          alert(`Successfully downloaded ${loaded} images as a zip file!`);
        } catch (error) {
          console.error('Download error:', error);
          alert('Failed to create zip file. Please try again.');
        } finally {
          // Re-enable button
          downloadBtn.disabled = false;
          downloadBtn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
            <circle cx="8.5" cy="8.5" r="1.5"/>
            <polyline points="21 15 16 10 5 21"/>
          </svg>
          Download Images`;
        }
      });
    })();

    // Configure users per stage for the First Trip journey
    // For this journey, all steps have the same user (parent), but the pattern supports different users per step
    // This must be defined BEFORE journey-scripts.js loads
    window.JOURNEY_STAGE_USERS = {
      1: [0], // Setup - parent persona (index 0)
      2: [0], // Trigger - parent persona
      3: [0], // Interpretation - parent persona
      4: [0], // Action - parent persona
      5: [0], // Resolution - parent persona
      6: [0]  // Follow Up - parent persona
    };
  </script>
  <script src="journey-scripts.js"></script>
</body>
</html>
