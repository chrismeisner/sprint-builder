<!DOCTYPE html>
<html>
<head>
  <title>Modal Data Verification</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    .success { color: #4ec9b0; }
    .error { color: #f48771; }
    .warning { color: #dcdcaa; }
    .section {
      margin: 20px 0;
      padding: 15px;
      background: #252526;
      border-radius: 5px;
    }
    .section h2 {
      color: #569cd6;
      margin-top: 0;
    }
    pre {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 3px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>User Journey Modal - Data Verification</h1>
  
  <div id="output"></div>
  
  <script src="personas-data.js"></script>
  <script>
    function verifyData() {
      let html = '';
      let errors = 0;
      let warnings = 0;
      
      // Check if PERSONAS is defined
      if (typeof PERSONAS === 'undefined') {
        html += '<div class="section error">❌ ERROR: PERSONAS is not defined</div>';
        errors++;
      } else {
        html += '<div class="section success">✓ PERSONAS is defined</div>';
        
        // Verify each persona
        PERSONAS.forEach((persona, index) => {
          html += `<div class="section">`;
          html += `<h2>Persona ${index}: ${persona.name || 'Unnamed'}</h2>`;
          
          // Check required fields
          const checks = [
            { field: 'name', value: persona.name, required: true },
            { field: 'role', value: persona.role, required: true },
            { field: 'relationship', value: persona.relationship, required: false },
            { field: 'coreJob', value: persona.coreJob, required: true },
            { field: 'triggerMoments', value: persona.triggerMoments, required: true, isArray: true },
            { field: 'mustHaveOutcomes', value: persona.mustHaveOutcomes, required: true, isArray: true },
            { field: 'trustFairnessRules', value: persona.trustFairnessRules, required: true, isArray: true },
            { field: 'successLooksLike', value: persona.successLooksLike, required: true, isArray: true },
            { field: 'defaultVisibility', value: persona.defaultVisibility, required: true, isObject: true }
          ];
          
          checks.forEach(check => {
            const exists = check.value !== undefined && check.value !== null;
            const isEmpty = check.isArray ? (Array.isArray(check.value) && check.value.length === 0) : false;
            
            if (!exists && check.required) {
              html += `<div class="error">❌ Missing required field: ${check.field}</div>`;
              errors++;
            } else if (!exists && !check.required) {
              html += `<div class="warning">⚠️  Optional field missing: ${check.field}</div>`;
              warnings++;
            } else if (isEmpty) {
              html += `<div class="warning">⚠️  Empty array: ${check.field}</div>`;
              warnings++;
            } else {
              let preview = '';
              if (check.isArray) {
                preview = ` (${check.value.length} items)`;
              } else if (check.isObject) {
                preview = ` (${Object.keys(check.value).length} keys)`;
              } else if (typeof check.value === 'string' && check.value.length > 50) {
                preview = `: "${check.value.substring(0, 47)}..."`;
              } else if (typeof check.value === 'string') {
                preview = `: "${check.value}"`;
              }
              html += `<div class="success">✓ ${check.field}${preview}</div>`;
            }
          });
          
          // Show sample data
          html += '<h3>Sample Data Preview:</h3>';
          html += '<pre>' + JSON.stringify({
            name: persona.name,
            role: persona.role,
            relationship: persona.relationship,
            coreJob: persona.coreJob?.substring(0, 60) + '...',
            triggerMomentsCount: persona.triggerMoments?.length,
            mustHaveOutcomesCount: persona.mustHaveOutcomes?.length,
            trustFairnessRulesCount: persona.trustFairnessRules?.length,
            successLooksLikeCount: persona.successLooksLike?.length,
            hasDefaultVisibility: !!persona.defaultVisibility
          }, null, 2) + '</pre>';
          
          html += '</div>';
        });
      }
      
      // Summary
      html = `
        <div class="section">
          <h2>Verification Summary</h2>
          <div class="${errors > 0 ? 'error' : 'success'}">Errors: ${errors}</div>
          <div class="${warnings > 0 ? 'warning' : 'success'}">Warnings: ${warnings}</div>
          <div>Total Personas: ${typeof PERSONAS !== 'undefined' ? PERSONAS.length : 0}</div>
        </div>
      ` + html;
      
      // Test modal data mapping
      if (typeof PERSONAS !== 'undefined' && PERSONAS.length > 0) {
        html += '<div class="section">';
        html += '<h2>Modal Data Mapping Test</h2>';
        html += '<p>Testing the data extraction logic used in journey-scripts.js:</p>';
        
        const persona = PERSONAS[0];
        const role = persona.role || '';
        const relationship = persona.relationship || '';
        const roleDisplay = relationship ? `${role} — ${relationship}` : role;
        const quote = persona.coreJob || '';
        const goals = persona.mustHaveOutcomes?.map(outcome => 
          outcome.description ? `${outcome.label}: ${outcome.description}` : outcome.label
        ) || [];
        const painPoints = persona.trustFairnessRules || [];
        const behaviors = persona.triggerMoments || [];
        const tags = persona.successLooksLike || [];
        
        const visibilityInfo = [];
        if (persona.defaultVisibility?.sees) {
          visibilityInfo.push(`Sees: ${persona.defaultVisibility.sees}`);
        }
        if (persona.defaultVisibility?.doesNotSee) {
          visibilityInfo.push(`Does not see: ${persona.defaultVisibility.doesNotSee}`);
        }
        
        html += '<pre>' + JSON.stringify({
          modalUserName: persona.name,
          modalUserRole: roleDisplay,
          modalUserQuote: quote.substring(0, 60) + '...',
          modalUserTags: tags,
          modalUserGoals: goals.map(g => g.substring(0, 40) + '...'),
          modalUserPains: painPoints.map(p => p.substring(0, 40) + '...'),
          modalUserBehaviors: behaviors.map(b => b.substring(0, 40) + '...'),
          modalUserStages: visibilityInfo.map(v => v.substring(0, 40) + '...')
        }, null, 2) + '</pre>';
        
        html += '</div>';
      }
      
      document.getElementById('output').innerHTML = html;
    }
    
    verifyData();
  </script>
</body>
</html>
