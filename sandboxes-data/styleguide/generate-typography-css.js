#!/usr/bin/env node

/**
 * Generate typography-styles.css from typography-data.js
 * 
 * Usage: node generate-typography-css.js
 * 
 * This script reads the single source of truth (typography-data.js)
 * and generates the CSS file that both fonts.html and style-tiles.html use.
 */

import { typeCatalog } from './typography-data.js';
import { writeFileSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Helper to get font family CSS value from var reference
const fontFamilyMap = {
  "var(--font-family-acme)": '"Acme Gothic Condensed", var(--font-family-sans)',
  "var(--font-family-tight)": '"Inter Tight", var(--font-family-sans)',
  "var(--font-family-sans)": 'var(--font-family-sans)',
  "var(--font-family-mono)": 'var(--font-family-mono)'
};

// Generate CSS header
let css = `/**
 * Typography Styles - Generated from typography-data.js
 * 
 * DO NOT EDIT THIS FILE DIRECTLY!
 * This file is auto-generated from typography-data.js
 * 
 * To update typography specs:
 * 1. Edit typography-data.js
 * 2. Run: node generate-typography-css.js
 * 3. Changes will automatically apply to all pages that link to this file
 * 
 * Last generated: ${new Date().toISOString()}
 */

`;

// Group styles by font family for better organization
const stylesByFamily = new Map();

// Collect all styles
typeCatalog.forEach(group => {
  group.items.forEach(style => {
    const family = style.fontFamily || 'var(--font-family-sans)';
    if (!stylesByFamily.has(family)) {
      stylesByFamily.set(family, []);
    }
    stylesByFamily.get(family).push(style);
  });
});

// Generate font family assignments section
css += `/* =============================================================================
   FONT FAMILY ASSIGNMENTS
   ============================================================================= */

`;

stylesByFamily.forEach((styles, family) => {
  const selectors = styles.map(s => `[data-style="${s.name}"]`).join(',\n');
  css += `${selectors} {\n`;
  css += `  font-family: ${fontFamilyMap[family] || family};\n`;
  css += `}\n\n`;
});

// Generate styles by category
typeCatalog.forEach(group => {
  if (group.items.length === 0) return;
  
  css += `/* =============================================================================
   ${group.title.toUpperCase()}
   ============================================================================= */

`;

  group.items.forEach(style => {
    css += `[data-style="${style.name}"] {\n`;
    css += `  font-size: ${style.sizeDesktop || style.size};\n`;
    css += `  line-height: ${style.lineHeight};\n`;
    css += `  font-weight: ${style.weight};\n`;
    css += `  letter-spacing: ${style.letterSpacing};\n`;
    
    if (style.transform) {
      css += `  text-transform: ${style.transform};\n`;
    }
    
    css += `}\n\n`;

    // Add mobile overrides if different from desktop
    const mobileSize = style.sizeMobile || style.sizeDesktop || style.size;
    const mobileLineHeight = style.lineHeightMobile || style.lineHeight;
    const hasMobileDifference = 
      mobileSize !== (style.sizeDesktop || style.size) || 
      mobileLineHeight !== style.lineHeight;

    if (hasMobileDifference) {
      css += `@media (max-width: 640px) {\n`;
      css += `  [data-style="${style.name}"] {\n`;
      
      if (mobileSize !== (style.sizeDesktop || style.size)) {
        css += `    font-size: ${mobileSize};\n`;
      }
      
      if (mobileLineHeight !== style.lineHeight) {
        css += `    line-height: ${mobileLineHeight};\n`;
      }
      
      css += `  }\n`;
      css += `}\n\n`;
    }
  });
});

// Add Google Slides font alternatives
css += `/* =============================================================================
   GOOGLE SLIDES FONT ALTERNATIVES
   When using .font-google-slides on a container, swap Acme Gothic ‚Üí Special Gothic
   ============================================================================= */

.font-google-slides [data-style="H1"],
.font-google-slides [data-style="H2"] {
  font-family: 'Special Gothic Condensed One', var(--font-family-sans);
  font-weight: 400;
}
`;

// Write the CSS file
const outputPath = join(__dirname, 'typography-styles.css');
writeFileSync(outputPath, css, 'utf8');

console.log('‚úÖ Generated typography-styles.css from typography-data.js');
console.log(`üìù Output: ${outputPath}`);
