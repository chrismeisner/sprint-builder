# Workshop Cleanup Guide

## Overview

This guide walks you through removing workshop deliverables from your existing sprint packages and deleting them from the deliverables catalog. Workshops are now generated by AI, not selected from a catalog.

## What Gets Cleaned Up

1. **Sprint Packages** - Removes workshops from all 3 packages:
   - Brand Identity Sprint (remove "Sprint Kickoff Workshop - Branding")
   - MVP Launch Sprint (remove "Sprint Kickoff Workshop - Product")
   - Startup Branding Sprint (remove "Sprint Kickoff Workshop - Startup")

2. **Active Sprint Drafts** - Removes workshops from any existing sprint drafts that have them

3. **Deliverables Table** - Permanently deletes workshop deliverables

## Files Modified

### 1. Package Seed File
**File**: `app/api/admin/sprint-packages/seed/route.ts`

**Changes**:
- Removed all workshop deliverables from package definitions
- Updated comment to reflect that workshops are generated by AI
- Each package now has 2-3 execution deliverables only

### 2. Cleanup API Endpoint
**File**: `app/api/admin/workshops/cleanup/route.ts` (**NEW**)

**Features**:
- **GET** - Preview what will be deleted (dry run)
- **POST** - Execute cleanup (requires confirmation)
- Transaction-safe (all-or-nothing)
- Admin-only access

### 3. Admin UI
**Files**: 
- `app/dashboard/workshop-cleanup/page.tsx` (**NEW**)
- `app/dashboard/workshop-cleanup/WorkshopCleanupClient.tsx` (**NEW**)

**Features**:
- Visual preview of what will be deleted
- Shows affected packages and sprints
- Confirmation dialog before deletion
- Success/error feedback

## How to Use

### Option 1: Visual Admin Page (Recommended)

1. **Restart your dev server** to apply schema changes:
   ```bash
   # Stop server (Ctrl+C)
   npm run dev
   ```

2. **Navigate to cleanup page** (logged in as admin):
   ```
   http://localhost:3000/dashboard/workshop-cleanup
   ```

3. **Preview the changes**:
   - Click "Preview Cleanup"
   - Review the list of workshops to be deleted
   - Check which packages and sprints are affected

4. **Execute cleanup**:
   - Click "Confirm & Delete Workshops"
   - Confirm the dialog
   - Wait for success message

5. **Done!** 
   - All workshops removed from packages
   - All workshops deleted from database
   - Future sprint packages will not include workshops

### Option 2: API Endpoint (Advanced)

```bash
# Step 1: Preview what will be deleted
curl http://localhost:3000/api/admin/workshops/cleanup

# Step 2: Execute cleanup (must be logged in as admin)
curl -X POST http://localhost:3000/api/admin/workshops/cleanup
```

## Expected Results

### Before Cleanup
- **Brand Identity Sprint**: 3 deliverables (1 workshop + 2 execution)
- **MVP Launch Sprint**: 3 deliverables (1 workshop + 2 execution)
- **Startup Branding Sprint**: 4 deliverables (1 workshop + 3 execution)
- **Total**: 3 workshop deliverables in `deliverables` table

### After Cleanup
- **Brand Identity Sprint**: 2 deliverables (execution only)
- **MVP Launch Sprint**: 2 deliverables (execution only)
- **Startup Branding Sprint**: 3 deliverables (execution only)
- **Total**: 0 workshop deliverables in `deliverables` table

## What Happens to Pricing?

All packages use **dynamic pricing** (calculated from deliverables at base complexity 1.0):

### Before Cleanup
- Brand Identity Sprint: ~$2,900 (includes $300 workshop)
- MVP Launch Sprint: ~$7,300 (includes $400 workshop)
- Startup Branding Sprint: ~$4,600 (includes $400 workshop)

### After Cleanup
- Brand Identity Sprint: ~$2,600 (workshop removed)
- MVP Launch Sprint: ~$6,900 (workshop removed)
- Startup Branding Sprint: ~$4,200 (workshop removed)

Prices will be slightly lower since workshops are no longer included in the base package. The custom workshop will be generated by AI after the client selects their package.

## Safety Features

1. **Transaction-safe**: Uses database transactions (all-or-nothing)
2. **Preview mode**: See what will be deleted before committing
3. **Admin-only**: Requires admin authentication
4. **Confirmation dialog**: Must confirm before deletion
5. **Rollback**: If any step fails, all changes are rolled back

## Rollback Plan

If you need to restore workshops (unlikely):

1. **Reseed workshops**:
   ```bash
   curl -X POST http://localhost:3000/api/admin/workshops/seed
   ```

2. **Re-add to packages manually** via admin UI or database

However, this is **not recommended** since the new system generates workshops dynamically.

## Testing After Cleanup

1. **Check packages page**:
   - Visit `/packages`
   - Verify packages show 2-3 deliverables (no workshops)
   - Pricing should be slightly lower

2. **Create a new sprint**:
   - Select a package
   - Verify NO workshop appears in deliverables list
   - Verify sprint draft is created successfully

3. **Test workshop generation**:
   - As admin, navigate to a sprint draft
   - Click "Create Workshop"
   - Verify AI generates custom workshop

## Troubleshooting

### "Admin access required"
- Make sure you're logged in as an admin user
- Check that `is_admin = true` in your `accounts` table

### "No workshop deliverables found"
- Workshops were already cleaned up
- Nothing to do!

### "Database transaction failed"
- Check database connection
- Check logs for specific error
- Transaction was rolled back (no partial changes)

### Packages still showing workshops
- Hard refresh the page (Cmd+Shift+R)
- Check that cleanup completed successfully
- Check `sprint_package_deliverables` table

## Next Steps

After cleanup:

1. âœ… **Package seed updated** - Future package seeding won't include workshops
2. âœ… **Workshops removed** - Existing packages cleaned up
3. âœ… **AI generation ready** - New sprints will get custom workshops
4. ðŸ”„ **Test the flow** - Create a sprint and generate a workshop

---

**Status**: Ready to execute cleanup after dev server restart

